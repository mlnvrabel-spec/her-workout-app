<!DOCTYPE html>
<!-- saved from url=(0095)file:///C:/Users/mlnvr/Desktop/Antigravity/Workout%20Split%20Dashboard/Workout%20Dashboard.html -->
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Training</title>

    <!-- =============================================
         PWA / HOME SCREEN ICON CONFIGURATION
         ============================================= -->
    <!-- Android: Enables "Add to Home Screen" without address bar -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0d0d14">
    <meta name="application-name" content="Training">

    <!-- iOS: Enables standalone mode (no Safari UI) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Training">

    <!-- FAVICON & APP ICON (Using user-provided SVG path) -->
    <!-- FAVICON & APP ICON (Using user-provided SVG path) -->
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,100..900&display=swap" rel="stylesheet">
    <style>
        /* ========================================
           CSS VARIABLES & THEME CONFIGURATION
           ======================================== */
        :root {
            /* Geometry */
            --radius-xl: 28px;
            --radius-lg: 20px;
            --radius-sm: 12px;
            --space-xs: 8px;
            --space-sm: 16px;
            --space-md: 24px;
            --space-lg: 32px;
            --nav-height: 80px;

            /* Animation - Studio 2026: Sub-300ms micro-interactions */
            --ease-fluid: cubic-bezier(0.22, 1, 0.36, 1);
            --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --duration-micro: 180ms;
            --duration-fast: 250ms;
            --duration-normal: 350ms;

            /* Typography - Studio 2026: Fluid with clamp() */
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --text-xs: clamp(0.625rem, 0.5rem + 0.5vw, 0.75rem);
            --text-sm: clamp(0.75rem, 0.65rem + 0.5vw, 0.875rem);
            --text-base: clamp(0.875rem, 0.8rem + 0.4vw, 1rem);
            --text-lg: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
            --text-xl: clamp(1.125rem, 1rem + 0.6vw, 1.375rem);
            --text-2xl: clamp(1.5rem, 1.2rem + 1.5vw, 2rem);
            --text-hero: clamp(2.25rem, 1.8rem + 2.5vw, 3rem);
        }

        /* DARK THEME (Default) - with oklch() fallbacks for older browsers */
        [data-theme="dark"] {
            /* Fallbacks for browsers without oklch() support */
            --bg-color: #0d0d14;
            --bg-color: oklch(5% 0.01 270);
            --bg-gradient: radial-gradient(ellipse at 0% 0%, #1a1a2e 0%, #0d0d14 50%);
            --bg-gradient: radial-gradient(ellipse at 0% 0%, oklch(18% 0.04 260) 0%, oklch(5% 0.01 270) 50%);

            --text-primary: #ffffff;
            --text-primary: oklch(100% 0 0);
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-secondary: oklch(85% 0 0 / 0.7);
            /* Increased opacity from 0.45 to 0.6 for better contrast (WCAG AA) */
            --text-tertiary: rgba(255, 255, 255, 0.6);
            --text-tertiary: oklch(75% 0 0 / 0.6);

            /* Glass Surfaces - Glassmorphism 2.0 with depth layers */
            --glass-surface: rgba(255, 255, 255, 0.04);
            --glass-surface: oklch(100% 0 0 / 0.04);
            --glass-surface-strong: rgba(255, 255, 255, 0.08);
            --glass-surface-strong: oklch(100% 0 0 / 0.08);
            --glass-surface-elevated: rgba(255, 255, 255, 0.12);
            --glass-surface-elevated: oklch(100% 0 0 / 0.12);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-border: oklch(100% 0 0 / 0.1);
            --glass-highlight: rgba(255, 255, 255, 0.2);
            --glass-highlight: oklch(100% 0 0 / 0.2);
            --glass-shadow:
                0 4px 16px rgba(0, 0, 0, 0.3),
                0 12px 40px rgba(0, 0, 0, 0.4);
            --glass-shadow-elevated:
                0 8px 24px rgba(0, 0, 0, 0.4),
                0 20px 60px rgba(0, 0, 0, 0.5);

            /* Navigation */
            --nav-glass: rgba(255, 255, 255, 0.03);
            --nav-glass: oklch(100% 0 0 / 0.03);
            --nav-text: #ffffff;
            --nav-text: oklch(100% 0 0);
            --nav-active-pill: rgba(255, 255, 255, 0.15);
            --nav-active-pill: oklch(100% 0 0 / 0.15);
        }

        /* LIGHT THEME - with oklch() fallbacks for older browsers */
        [data-theme="light"] {
            --bg-color: #f5f5f8;
            --bg-color: oklch(97% 0.005 270);
            --bg-gradient: radial-gradient(ellipse at 100% 0%, #e8e8f0 0%, #ffffff 70%);
            --bg-gradient: radial-gradient(ellipse at 100% 0%, oklch(94% 0.015 250) 0%, oklch(100% 0 0) 70%);

            --text-primary: #1a1a2e;
            --text-primary: oklch(15% 0.01 270);
            --text-secondary: rgba(26, 26, 46, 0.7);
            --text-secondary: oklch(35% 0.01 270 / 0.7);
            /* Increased opacity from 0.5 to 0.65 for better contrast */
            --text-tertiary: rgba(26, 26, 46, 0.65);
            --text-tertiary: oklch(45% 0.01 270 / 0.65);

            /* Glass Surfaces - Glassmorphism 2.0 */
            --glass-surface: rgba(255, 255, 255, 0.75);
            --glass-surface: oklch(100% 0 0 / 0.75);
            --glass-surface-strong: rgba(255, 255, 255, 0.9);
            --glass-surface-strong: oklch(100% 0 0 / 0.9);
            --glass-surface-elevated: rgba(255, 255, 255, 0.95);
            --glass-surface-elevated: oklch(100% 0 0 / 0.95);
            --glass-border: rgba(255, 255, 255, 0.9);
            --glass-border: oklch(100% 0 0 / 0.9);
            --glass-highlight: #ffffff;
            --glass-highlight: oklch(100% 0 0);
            --glass-shadow:
                0 4px 12px rgba(0, 0, 0, 0.04),
                0 8px 24px rgba(0, 0, 0, 0.06);
            --glass-shadow-elevated:
                0 8px 20px rgba(0, 0, 0, 0.06),
                0 16px 40px rgba(0, 0, 0, 0.08);

            /* Navigation */
            --nav-glass: rgba(255, 255, 255, 0.85);
            --nav-glass: oklch(100% 0 0 / 0.85);
            --nav-text: #1a1a2e;
            --nav-text: oklch(15% 0.01 270);
            --nav-active-pill: rgba(0, 0, 0, 0.08);
            --nav-active-pill: oklch(0% 0 0 / 0.08);
        }

        /* Day Specific Accents - Studio 2026: Ultra-vibrant oklch() */
        .accent-push-a {
            --accent-color: oklch(70% 0.22 25);
            --accent-glow: oklch(70% 0.22 25 / 0.35);
            --accent-gradient: linear-gradient(135deg, oklch(70% 0.22 25) 0%, oklch(62% 0.24 20) 100%);
        }

        .accent-pull-a {
            --accent-color: oklch(70% 0.15 300);
            --accent-glow: oklch(70% 0.15 300 / 0.35);
            --accent-gradient: linear-gradient(135deg, oklch(70% 0.15 300) 0%, oklch(60% 0.18 290) 100%);
        }

        .accent-push-b {
            --accent-color: oklch(78% 0.14 175);
            --accent-glow: oklch(78% 0.14 175 / 0.35);
            --accent-gradient: linear-gradient(135deg, oklch(78% 0.14 175) 0%, oklch(70% 0.16 170) 100%);
        }

        .accent-pull-b {
            --accent-color: oklch(72% 0.18 230);
            --accent-glow: oklch(72% 0.18 230 / 0.35);
            --accent-gradient: linear-gradient(135deg, oklch(72% 0.18 230) 0%, oklch(75% 0.2 200) 100%);
        }

        /* GLOBAL RESET */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            background-image: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-primary);
            font-family: var(--font-main);
            /* Fallback for browsers without dvh support */
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* Animated background glow */
        .liquid-bg {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, var(--accent-glow), transparent 50%);
            opacity: 0.5;
            pointer-events: none;
            z-index: -1;
            transition: background 0.8s ease;
            animation: liquidFloat 20s ease-in-out infinite;
        }

        @keyframes liquidFloat {

            0%,
            100% {
                transform: translate(0, 0) rotate(0deg);
            }

            33% {
                transform: translate(2%, 2%) rotate(1deg);
            }

            66% {
                transform: translate(-1%, 1%) rotate(-0.5deg);
            }
        }

        #app-container {
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
            padding-bottom: calc(var(--nav-height) + var(--space-md));
            position: relative;
            z-index: 1;
        }

        /* ========================================
           HEADER
           ======================================== */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: var(--space-lg) var(--space-md) var(--space-sm);
            background: transparent;
            transition: all var(--duration-normal) var(--ease-fluid);
            /* Bug fix: Prevent layout thrashing during scroll */
            will-change: padding, backdrop-filter;
        }

        header.scrolled {
            padding: var(--space-sm) var(--space-md);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border-bottom: 1px solid var(--glass-border);
            background: var(--glass-surface);
            display: block;
            /* Reset to block for stable text alignment */
            position: sticky;
        }

        /* Position toggle absolutely to not affect title alignment */
        header.scrolled .header-top {
            margin-bottom: 0;
            width: auto;
            position: absolute;
            top: 50%;
            right: var(--space-md);
            transform: translateY(-50%);
            z-index: 10;
        }

        header.scrolled .app-label {
            display: none;
        }

        header.scrolled h1.day-title {
            font-size: var(--text-2xl);
            letter-spacing: -0.5px;
            margin: 0;
            line-height: 1.5;
        }

        header.scrolled p.day-subtitle {
            display: none;
        }

        header.scrolled .theme-toggle {
            width: 36px;
            height: 36px;
        }

        header.scrolled .theme-toggle svg {
            width: 16px;
            height: 16px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xs);
        }

        .app-label {
            font-size: var(--text-xs);
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            transition: opacity var(--duration-fast) ease, height var(--duration-fast) ease, margin var(--duration-fast) ease;
        }

        .theme-toggle {
            background: var(--glass-surface-strong);
            border: 1px solid var(--glass-border);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px oklch(0% 0 0 / 0.1);
            transition: transform var(--duration-micro) var(--ease-bounce), box-shadow var(--duration-micro) ease;
        }

        .theme-toggle:hover {
            box-shadow: 0 6px 16px oklch(0% 0 0 / 0.15);
        }

        .theme-toggle:active {
            transform: scale(0.92);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: var(--text-primary);
            transition: transform 0.5s var(--ease-bounce);
        }

        h1.day-title {
            font-size: var(--text-hero);
            font-weight: 900;
            letter-spacing: -1.5px;
            line-height: 1.05;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: font-size var(--duration-normal) var(--ease-fluid),
                letter-spacing var(--duration-normal) var(--ease-fluid),
                font-weight var(--duration-normal) var(--ease-fluid);
            /* Studio 2026: Kinetic variable font - support weight axis */
            font-variation-settings: 'wght' 900;
        }

        /* Kinetic font: weight shifts when scrolled */
        header.scrolled h1.day-title {
            font-variation-settings: 'wght' 700;
        }

        p.day-subtitle {
            font-size: var(--text-base);
            color: var(--text-secondary);
            margin-top: 6px;
            font-weight: 500;
            transition: opacity var(--duration-fast) ease, height var(--duration-fast) ease, margin var(--duration-fast) ease;
        }

        /* ========================================
           DAY THEME HERO
           ======================================== */
        .day-theme-hero {
            margin: 0 var(--space-md) var(--space-md);
            padding: var(--space-sm) var(--space-md);
            background: var(--glass-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .day-theme-hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--accent-glow), transparent 70%);
            opacity: 0.3;
            pointer-events: none;
        }

        .theme-label {
            font-size: var(--text-xs);
            font-weight: 700;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--accent-color);
            margin-bottom: 4px;
            display: block;
            position: relative;
        }

        .theme-text {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-secondary);
            line-height: 1.4;
            position: relative;
        }

        /* ========================================
           PROGRESS BAR
           ======================================== */
        .day-progress {
            height: 4px;
            background: var(--glass-surface);
            border-radius: 2px;
            overflow: hidden;
            margin: 0 var(--space-md) var(--space-sm);
        }

        .day-progress-fill {
            height: 100%;
            background: var(--accent-gradient);
            border-radius: 2px;
            width: 0%;
            transition: width 0.5s var(--ease-spring);
            box-shadow: 0 0 12px var(--accent-glow);
            position: relative;
            overflow: hidden;
        }

        /* Studio 2026: Progress shimmer animation */
        .day-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent 0%,
                    oklch(100% 0 0 / 0.4) 50%,
                    transparent 100%);
            animation: progressShimmer 2s ease-in-out infinite;
        }

        @keyframes progressShimmer {
            0% {
                left: -100%;
            }

            100% {
                left: 200%;
            }
        }

        /* ========================================
           EXERCISE CARDS
           ======================================== */
        .card-list {
            padding: 0 var(--space-md);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .card {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-md);
            backdrop-filter: blur(24px) saturate(120%);
            -webkit-backdrop-filter: blur(24px) saturate(120%);
            box-shadow: var(--glass-shadow);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: transform var(--duration-micro) var(--ease-spring),
                box-shadow var(--duration-micro) ease,
                background var(--duration-micro) ease;
            animation: cardEnter 0.4s var(--ease-spring) backwards;
        }

        .card:hover {
            box-shadow: var(--glass-shadow-elevated);
        }

        .card:nth-child(1) {
            animation-delay: 0.05s;
        }

        .card:nth-child(2) {
            animation-delay: 0.1s;
        }

        .card:nth-child(3) {
            animation-delay: 0.15s;
        }

        .card:nth-child(4) {
            animation-delay: 0.2s;
        }

        .card:nth-child(5) {
            animation-delay: 0.25s;
        }

        @keyframes cardEnter {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
        }

        .card:active {
            transform: scale(0.98);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--glass-highlight), transparent);
        }

        /* Card Header */
        .card-header {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: var(--space-sm);
        }

        .exercise-order {
            width: 32px;
            height: 32px;
            background: var(--accent-gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: #fff;
            box-shadow: 0 4px 12px var(--accent-glow);
            flex-shrink: 0;
            /* Studio 2026: Accent glow pulse */
            animation: accentPulse 2.5s ease-in-out infinite;
        }

        @keyframes accentPulse {

            0%,
            100% {
                box-shadow: 0 4px 12px var(--accent-glow);
            }

            50% {
                box-shadow: 0 4px 20px var(--accent-glow), 0 0 30px var(--accent-glow);
            }
        }

        .card.completed .exercise-order {
            animation: none;
            opacity: 0.5;
        }

        .exercise-info h3 {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            transition: all var(--duration-fast) ease;
            /* Text overflow handling for long exercise names */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 200px;
        }




        .meta-row {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .meta-pill {
            font-size: var(--text-sm);
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 8px;
            background: oklch(100% 0 0 / 0.06);
            color: var(--text-secondary);
        }

        .meta-pill.accent {
            background: var(--accent-glow);
            color: var(--accent-color);
        }

        .rir-chip {
            font-size: var(--text-xs);
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .rir-chip.intense {
            background: oklch(65% 0.22 25 / 0.15);
            color: oklch(70% 0.2 25);
        }

        .rir-chip.controlled {
            background: oklch(75% 0.15 70 / 0.15);
            color: oklch(80% 0.15 70);
        }

        .rest-badge {
            font-size: var(--text-xs);
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 6px;
            background: oklch(100% 0 0 / 0.06);
            color: var(--text-tertiary);
            cursor: pointer;
            transition: background var(--duration-micro) ease, color var(--duration-micro) ease;
        }

        .rest-badge:hover {
            background: var(--accent-glow);
            color: var(--accent-color);
        }

        .checkbox-wrapper {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            border: 2px solid var(--glass-border);
            background: oklch(0% 0 0 / 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--duration-micro) var(--ease-bounce);
            flex-shrink: 0;
        }

        .card.completed .checkbox-wrapper {
            background: var(--accent-gradient);
            border-color: transparent;
            box-shadow: 0 4px 12px var(--accent-glow);
        }

        /* Studio 2026: Visual haptic feedback on completion */
        @keyframes completePulse {
            0% {
                box-shadow: var(--glass-shadow);
                border-color: var(--glass-border);
            }

            40% {
                box-shadow: var(--glass-shadow-elevated), 0 0 25px var(--accent-glow);
                border-color: var(--accent-color);
            }

            100% {
                box-shadow: var(--glass-shadow);
                border-color: var(--glass-border);
            }
        }

        .card.just-completed {
            animation: completePulse 0.5s var(--ease-fluid);
            /* Prevent cardEnter animation from replaying */
            opacity: 1 !important;
            transform: none !important;
        }

        .card.completed .exercise-info h3 {
            text-decoration: line-through;
            opacity: 0.4;
        }

        .card.completed .meta-row {
            opacity: 0.4;
        }

        .check-icon {
            width: 16px;
            height: 16px;
            fill: #fff;
            opacity: 0;
            transform: scale(0.5);
            transition: all var(--duration-micro) var(--ease-bounce);
        }

        .card.completed .check-icon {
            opacity: 1;
            transform: scale(1);
        }

        /* EXPANDED DETAILS */
        .details-wrapper {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s var(--ease-fluid);
        }

        .card.expanded .details-wrapper {
            grid-template-rows: 1fr;
            margin-top: var(--space-sm);
        }

        .details-inner {
            overflow: hidden;
            opacity: 0;
            transform: translateY(8px);
            transition: opacity 0.3s ease 0.1s, transform 0.3s ease 0.1s;
        }

        .card.expanded .details-inner {
            opacity: 1;
            transform: translateY(0);
        }

        .glass-inner-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            margin-top: var(--space-xs);
            border: 1px solid var(--glass-border);
        }

        .label-pill {
            font-size: var(--text-xs);
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--accent-color);
            margin-bottom: 8px;
            display: block;
        }

        .label-pill.warning {
            color: oklch(80% 0.15 60);
        }

        .label-pill.pro {
            color: oklch(78% 0.14 175);
        }

        .label-pill.accent {
            color: var(--accent-color);
        }

        .tip-text {
            font-size: var(--text-sm);
            line-height: 1.55;
            color: var(--text-secondary);
        }

        /* Technique Steps */
        .technique-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .technique-list li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: var(--text-sm);
            line-height: 1.5;
            color: var(--text-secondary);
        }

        .step-num {
            min-width: 20px;
            height: 20px;
            background: var(--accent-gradient);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xs);
            font-weight: 700;
            color: #fff;
            flex-shrink: 0;
        }

        /* Mistakes List */
        .mistakes-panel {
            background: oklch(80% 0.15 60 / 0.05);
            border-color: oklch(80% 0.15 60 / 0.15);
        }

        .mistakes-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .mistakes-list li {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: var(--text-sm);
            line-height: 1.5;
            color: var(--text-secondary);
        }

        .mistake-icon {
            color: oklch(70% 0.22 25);
            font-weight: 700;
            flex-shrink: 0;
        }

        /* Visualization Panel */
        .viz-panel {
            background: linear-gradient(135deg, rgba(var(--accent-color), 0.05), transparent);
            position: relative;
            overflow: hidden;
        }

        .viz-panel::before {
            content: '"';
            position: absolute;
            top: 8px;
            right: 12px;
            font-size: 48px;
            font-weight: 900;
            color: var(--accent-glow);
            opacity: 0.3;
            line-height: 1;
        }

        /* Pro Tip Panel */
        .pro-panel {
            background: oklch(78% 0.14 175 / 0.05);
            border-color: oklch(78% 0.14 175 / 0.15);
        }

        /* ========================================
           NAVIGATION DOCK
           ======================================== */
        .nav-dock-container {
            position: fixed;
            bottom: var(--space-md);
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 550px;
            /* Increased to accommodate button */
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            pointer-events: none;
            /* Let clicks pass through gaps */
            padding: 0 16px;
            /* Horizontal safety padding */
        }

        .nav-dock {
            height: 72px;
            border-radius: var(--radius-xl);
            background: var(--nav-glass);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid oklch(100% 0 0 / 0.08);
            /* Studio 2026: Floating island spatial depth */
            box-shadow:
                0 2px 4px oklch(0% 0 0 / 0.05),
                0 8px 16px oklch(0% 0 0 / 0.1),
                0 20px 40px oklch(0% 0 0 / 0.12),
                0 40px 80px oklch(0% 0 0 / 0.08),
                inset 0 1px 0 oklch(100% 0 0 / 0.12),
                inset 0 0 20px oklch(100% 0 0 / 0.02);
            display: flex;
            align-items: center;
            /* justify-content: space-around; REMOVED to allow flex-grow to work evenly */
            padding: 4px;
            /* Reduced padding to allow items to fill space */
            pointer-events: auto;
            flex-grow: 1;
        }

        .nav-item {
            position: relative;
            padding: 12px 0;
            cursor: pointer;
            text-align: center;
            border-radius: 99px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            flex: 1 1 0px;
        }

        .nav-item:first-child {
            border-top-left-radius: 99px;
            border-bottom-left-radius: 99px;
        }

        .nav-item:last-child {
            border-top-right-radius: 99px;
            border-bottom-right-radius: 99px;
        }

        .nav-day {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--nav-text);
            opacity: 0.4;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: opacity var(--duration-micro);
        }

        .nav-text {
            font-size: var(--text-sm);
            font-weight: 700;
            color: var(--nav-text);
            opacity: 0.5;
            transition: opacity var(--duration-micro);
        }

        .nav-item.active {
            background: var(--nav-active-pill);
        }

        .nav-item.active .nav-text,
        .nav-item.active .nav-day {
            opacity: 1;
        }

        /* AI Chat Button */
        #ai-trigger-btn {
            width: 50px;
            height: 50px;
            border-radius: 24px;
            /* Matches Nav */
            background: var(--glass-surface-strong);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.2s var(--ease-bounce);
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
            pointer-events: auto;
            /* Re-enable pointer events for the button */
        }

        #ai-trigger-btn:active {
            transform: scale(0.92);
        }

        #ai-trigger-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--accent-gradient);
            opacity: 0.1;
        }

        #ai-trigger-btn svg {
            width: 32px;
            height: 32px;
            fill: var(--accent-color);
            filter: drop-shadow(0 0 8px var(--accent-glow));
            transition: all 0.5s ease;
        }

        #ai-trigger-btn:hover svg {
            transform: scale(1.1) rotate(10deg);
        }



        /* Chat Overlay */
        .chat-overlay {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: none;
            align-items: flex-end;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .chat-overlay.active {
            display: flex;
            opacity: 1;
        }

        @media (min-width: 768px) {
            .chat-overlay {
                align-items: center;
            }
        }

        .chat-window {
            width: 100%;
            max-width: 600px;
            height: 85vh;
            background: var(--glass-surface-strong);
            border-radius: 28px 28px 0 0;
            border: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: translateY(100%);
            transition: transform 0.4s var(--ease-spring);
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.3);
        }

        @media (min-width: 768px) {
            .chat-window {
                height: 700px;
                border-radius: 28px;
                transform: translateY(20px) scale(0.95);
                opacity: 0;
            }

            .chat-overlay.active .chat-window {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .chat-overlay.active .chat-window {
            transform: translateY(0);
        }

        /* Chat Header */
        .chat-header {
            padding: 20px 24px;
            border-bottom: 0px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.02);
            flex-shrink: 0;
        }

        .chat-title {
            font-weight: 800;
            font-size: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }

        .chat-actions {
            display: flex;
            gap: 8px;
        }

        .chat-close,
        .settings-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            cursor: pointer;
            transition: background 0.2s;
            padding: 0;
            /* Fix: Remove browser default padding for perfect centering */
        }

        .chat-close svg,
        .settings-btn svg {
            width: 18px;
            height: 18px;
            fill: var(--text-secondary);
            display: block;
            /* Fix: Removes inline baseline spacing issues */
        }

        .chat-close:hover,
        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Chat Body */
        .chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            scroll-behavior: smooth;
        }

        .chat-message {
            max-width: 85%;
            padding: 14px 18px;
            border-radius: 20px;
            font-size: var(--text-base);
            line-height: 1.5;
            animation: messageIn 0.3s var(--ease-bounce) forwards;
            word-wrap: break-word;
        }

        .chat-message.system {
            align-self: center;
            background: transparent;
            color: var(--text-tertiary);
            font-size: var(--text-xs);
            text-align: center;
            border: 1px dashed var(--glass-border);
        }

        .chat-message.user {
            align-self: flex-end;
            background: var(--accent-gradient);
            color: #fff;
            border-bottom-right-radius: 4px;
            box-shadow: 0 4px 12px var(--accent-glow);
        }

        .chat-message.ai {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        @keyframes messageIn {
            from {
                opacity: 0;
                transform: translateY(10px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .chat-message p {
            margin-bottom: 8px;
        }

        .chat-message p:last-child {
            margin-bottom: 0;
        }

        .chat-message ul {
            margin-left: 20px;
            margin-bottom: 8px;
        }

        .chat-message strong {
            font-weight: 700;
            color: inherit;
        }

        /* Input Area */
        .chat-input-wrapper {
            padding: 16px 20px 24px;
            border-top: 1px solid var(--glass-border);
            display: flex;
            gap: 12px;
            background: rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }

        .chat-input {
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 14px 20px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            border-color: var(--accent-color);
            background: rgba(0, 0, 0, 0.4);
        }

        .chat-send {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: var(--accent-gradient);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px var(--accent-glow);
            transition: transform 0.2s var(--ease-bounce);
            flex-shrink: 0;
        }

        .chat-send:active {
            transform: scale(0.9);
        }

        .chat-send svg {
            width: 22px;
            height: 22px;
            fill: white;
            transform: translateX(-1px);
        }

        /* Settings Modal inside Chat */
        .api-settings {
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            margin-bottom: 16px;
            display: none;
            border: 1px solid var(--glass-border);
        }

        .api-settings.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .api-settings label {
            display: block;
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-bottom: 6px;
            text-transform: uppercase;
            font-weight: 700;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--glass-border);
            color: #fff;
            border-radius: 12px;
            font-family: monospace;
        }

        .save-btn {
            background: var(--glass-highlight);
            color: black;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 12px;
            cursor: pointer;
        }

        /* ========================================
           REST TIMER
           ======================================== */
        .timer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .timer-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .timer-card {
            background: var(--glass-surface-strong);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            text-align: center;
            min-width: 280px;
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            transform: scale(0.9);
            transition: transform 0.3s var(--ease-bounce);
        }

        .timer-overlay.active .timer-card {
            transform: scale(1);
        }

        .timer-label {
            font-size: var(--text-sm);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-tertiary);
            margin-bottom: var(--space-xs);
        }

        .timer-display {
            font-size: clamp(3rem, 2.5rem + 3vw, 4.5rem);
            font-weight: 800;
            color: var(--accent-color);
            font-variant-numeric: tabular-nums;
            line-height: 1;
            margin-bottom: var(--space-md);
        }

        .timer-btn {
            background: var(--accent-gradient);
            border: none;
            color: #fff;
            font-size: var(--text-base);
            font-weight: 700;
            padding: 14px 32px;
            border-radius: 16px;
            cursor: pointer;
            box-shadow: 0 8px 20px var(--accent-glow);
            transition: transform var(--duration-micro) ease;
        }

        .timer-btn:active {
            transform: scale(0.95);
        }

        /* Spacer - minimal to just clear nav */
        .spacer {
            height: 16px;
        }

        /* ========================================
           SKELETON LOADING STATES
           Studio 2026: Skeleton-first, never spinners
           ======================================== */
        @keyframes skeletonPulse {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 0.7;
            }
        }

        .skeleton {
            background: linear-gradient(90deg,
                    var(--glass-surface) 25%,
                    var(--glass-surface-strong) 50%,
                    var(--glass-surface) 75%);
            background-size: 200% 100%;
            animation: skeletonPulse 1.5s ease-in-out infinite;
            border-radius: var(--radius-sm);
        }

        .skeleton-card {
            height: 80px;
            margin-bottom: var(--space-sm);
            border-radius: var(--radius-xl);
        }

        .skeleton-text {
            height: 1em;
            width: 60%;
            margin-bottom: 0.5em;
        }

        .skeleton-text.short {
            width: 40%;
        }

        .card-list.loading .card {
            display: none;
        }

        .card-list.loading::before,
        .card-list.loading::after {
            content: '';
            display: block;
            background: var(--glass-surface);
            border-radius: var(--radius-xl);
            animation: skeletonPulse 1.5s ease-in-out infinite;
        }

        .card-list.loading::before {
            height: 100px;
            margin-bottom: var(--space-sm);
        }

        .card-list.loading::after {
            height: 100px;
            animation-delay: 0.2s;
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>

<body data-theme="dark" class="accent-pull-b">

    <div class="liquid-bg" id="liquid-bg"></div>

    <!-- Rest Timer Overlay - Modal with focus trap -->
    <div class="timer-overlay" id="timer-overlay" role="dialog" aria-modal="true" aria-labelledby="timer-label">
        <div class="timer-card">
            <span class="timer-label" id="timer-label-text">Rest Time</span>
            <div class="timer-display" id="timer-display" aria-live="polite" aria-atomic="true">2:00</div>
            <button class="timer-btn" id="timer-btn" aria-label="Skip rest timer">Skip</button>
        </div>
    </div>

    <!-- Main Scroll Container - Semantic HTML -->
    <main id="app-container">
        <header id="header" class="scrolled">
            <div class="header-top">
                <span class="app-label">Hypertrophy</span>
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark/light theme">
                    <svg id="theme-icon" viewBox="0 0 24 24" aria-hidden="true">
                        <path
                            d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z">
                        </path>
                    </svg>
                </button>
            </div>
            <h1 class="day-title" id="day-title">Pull B</h1>
            <p class="day-subtitle" id="day-subtitle">Hamstring Isolation + Upper Back Bias</p>
        </header>

        <!-- Day Theme Hero -->
        <div class="day-theme-hero">
            <span class="theme-label" id="theme-label">Today's Focus</span>
            <p class="theme-text" id="theme-text">Shortened Position Hamstrings + Horizontal Pulling.</p>
        </div>

        <!-- Progress Bar with ARIA -->
        <div class="day-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
            aria-label="Workout progress" id="progress-container">
            <div class="day-progress-fill" id="progress-fill" style="width: 0%;"></div>
        </div>

        <!-- Exercise Cards -->
        <div class="card-list" id="card-list"
            style="transition: opacity 0.25s, transform 0.25s; opacity: 1; transform: translateY(0px);">
            <article class="card expanded" id="pull-b-0">
                <div class="card-header">
                    <div class="exercise-order">1</div>
                    <div class="exercise-info">
                        <h3>Lat Pulldown</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">3×8-12</span>
                            <span class="rir-chip controlled">RIR 1-2</span>
                            <span class="rest-badge">2:00</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Lock thighs under pad tightly</li>
                                <li><span class="step-num">2</span>Keep torso relatively upright (slight lean okay)</li>
                                <li><span class="step-num">3</span>Drive elbows down towards hips</li>
                                <li><span class="step-num">4</span>Control the ascent to full stretch</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon">✗</span>Leaning back too far (turns into a row)</li>
                                <li><span class="mistake-icon">✗</span>Using momentum to start the pull</li>
                                <li><span class="mistake-icon">✗</span>Shrugging at the ears</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">Dragging the Wall</span>
                            <p class="tip-text">Visualize your elbows dragging down along a wall behind you.</p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">Use lifting straps here. Taking your grip strength out of the equation
                                allows you to push the lats to true failure without your forearms giving out first.</p>
                        </div>
                    </div>
                </div>
            </article>

            <article class="card" id="pull-b-1">
                <div class="card-header">
                    <div class="exercise-order">2</div>
                    <div class="exercise-info">
                        <h3>Seated Leg Curl</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">3×10-15</span>
                            <span class="rir-chip intense">RIR 0</span>
                            <span class="rest-badge">2:00</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Align knee with pivot</li>
                                <li><span class="step-num">2</span>Lock the thigh pad down hard onto legs</li>
                                <li><span class="step-num">3</span>Drive heels back and under</li>
                                <li><span class="step-num">4</span>Control the eccentric release (3 seconds)</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon">✗</span>Hips lifting off the seat (cheating)</li>
                                <li><span class="mistake-icon">✗</span>Dorsiflexing toes (keep ankles relaxed or
                                    neutral)</li>
                                <li><span class="mistake-icon">✗</span>Bouncing out of the stretched position</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">Digging a Trench</span>
                            <p class="tip-text">Imagine you're trying to dig a trench in the ground using your heels.
                            </p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">The seated curl places the hamstrings in a lengthened position (because
                                the hips are flexed). This makes it superior to the lying leg curl for hypertrophy. Grip
                                the handles tight to brace yourself into the seat.</p>
                        </div>
                    </div>
                </div>
            </article>

            <article class="card " id="pull-b-2">
                <div class="card-header">
                    <div class="exercise-order">3</div>
                    <div class="exercise-info">
                        <h3>Wide Grip Cable Row</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">3×10-12</span>
                            <span class="rir-chip controlled">RIR 1-2</span>
                            <span class="rest-badge">2:00</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Use a wide mag-grip or straight bar</li>
                                <li><span class="step-num">2</span>Keep torso upright (minimal sway)</li>
                                <li><span class="step-num">3</span>Pull elbows high and wide (shoulder height)</li>
                                <li><span class="step-num">4</span>Squeeze scapula together</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon">✗</span>Pulling elbows into sides (hits lats, not upper
                                    back)</li>
                                <li><span class="mistake-icon">✗</span>Rounding the back (spine safety)</li>
                                <li><span class="mistake-icon">✗</span>Excessive leaning back</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">Scarecrow Pull</span>
                            <p class="tip-text">Pull your elbows apart like a scarecrow. The goal is width.</p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">By flaring the elbows out to 45-60 degrees, you bias the upper back
                                (traps, rhomboids, rear delts) rather than the lats.</p>
                        </div>
                    </div>
                </div>
            </article>

            <article class="card " id="pull-b-3">
                <div class="card-header">
                    <div class="exercise-order">4</div>
                    <div class="exercise-info">
                        <h3>Face Pulls</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">2×15-20</span>
                            <span class="rir-chip intense">RIR 0</span>
                            <span class="rest-badge">90s</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Set rope to upper chest height</li>
                                <li><span class="step-num">2</span>Grasp rope with thumbs facing back (hammer grip)</li>
                                <li><span class="step-num">3</span>Pull towards forehead while spreading hands</li>
                                <li><span class="step-num">4</span>Externally rotate (hands finish behind ears)</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon">✗</span>Pulling to the chin/neck</li>
                                <li><span class="mistake-icon">✗</span>Keeping hands close together</li>
                                <li><span class="mistake-icon">✗</span>Using bodyweight to pull</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">Double Bicep Pose</span>
                            <p class="tip-text">Finish the movement in a "double bicep" pose. Your knuckles should be
                                facing the wall behind you.</p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">This is not a heavy strength movement. It's for rotator cuff health and
                                rear delts. If you go too heavy, your internal rotators (pecs/lats) will take over,
                                defeating the purpose.</p>
                        </div>
                    </div>
                </div>
            </article>

            <article class="card " id="pull-b-4">
                <div class="card-header">
                    <div class="exercise-order">5</div>
                    <div class="exercise-info">
                        <h3>Preacher Curl</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">2×10-15</span>
                            <span class="rir-chip intense">RIR 0</span>
                            <span class="rest-badge">90s</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Adjust seat so armpit fits snugly over pad</li>
                                <li><span class="step-num">2</span>Extend arm fully</li>
                                <li><span class="step-num">3</span>Curl weight without moving the upper arm</li>
                                <li><span class="step-num">4</span>Squeeze biceps at the top</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon">✗</span>Leaning back to gain leverage</li>
                                <li><span class="mistake-icon">✗</span>Lifting elbows off the pad</li>
                                <li><span class="mistake-icon">✗</span>Stopping short of full extension</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">The Hinge</span>
                            <p class="tip-text">Your arm is a simple hinge. Nothing else in the body moves.</p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">This exercises the biceps in the "shortened position." However, be
                                careful at the very bottom (full extension)—the load is high there. Control the negative
                                to avoid tendon strain.</p>
                        </div>
                    </div>
                </div>
            </article>
        </div>

        <div class="spacer"></div>
    </main>

    <!-- Navigation Dock Container (Grouping Dock + AI Button) -->
    <div class="nav-dock-container">
        <nav class="nav-dock" id="nav-dock">
            <div class="nav-item" data-day="0">
                <span class="nav-day">Day 1</span>
                <span class="nav-text">Push A</span>
            </div>
            <div class="nav-item" data-day="1">
                <span class="nav-day">Day 2</span>
                <span class="nav-text">Pull A</span>
            </div>
            <div class="nav-item" data-day="2">
                <span class="nav-day">Day 3</span>
                <span class="nav-text">Push B</span>
            </div>
            <div class="nav-item" data-day="3">
                <span class="nav-day">Day 4</span>
                <span class="nav-text">Pull B</span>
            </div>
        </nav>

        <!-- AI Trigger Button (Now inside the flex container) -->
        <div id="ai-trigger-btn">
            <!-- Minimalist Robot/Chat Icon via SVG (No face) -->
            <svg viewBox="0 0 24 24">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
            </svg>
        </div>
    </div>

    <!-- AI Chat Overlay -->
    <div class="chat-overlay" id="chat-overlay">
        <div class="chat-window">
            <div class="chat-header">
                <div class="chat-title">
                    <svg style="width:24px;height:24px;fill:var(--accent-color)" viewBox="0 0 24 24">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-12h2v6h-2zm0 8h2v2h-2z" />
                    </svg>
                    Mr. Olympia
                </div>
                <div class="chat-actions">
                    <div class="settings-btn" onclick="MrOlympia.toggleSettings()">⚙️</div>
                    <button class="chat-close" onclick="MrOlympia.toggle()" aria-label="Close Chat">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="chat-body" id="chat-body">
                <div class="api-settings" id="api-settings">
                    <label>OpenAI API Key (Stored Locally)</label>
                    <input type="password" class="api-input" id="api-key-input" placeholder="sk-..." />
                    <button class="save-btn" onclick="MrOlympia.saveKey()">Save Key</button>
                </div>
                <!-- Chat messages go here -->
            </div>

            <div class="chat-input-wrapper">
                <input type="text" class="chat-input" id="chat-input" placeholder="Ask about your hypertrophy plan..."
                    onkeypress="if(event.key==='Enter') MrOlympia.send()">
                <button class="chat-send" onclick="MrOlympia.send()">
                    <svg viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // MR. OLYMPIA - AI CHATBOT LOGIC
        // ========================================
        const MrOlympia = {
            apiKey: localStorage.getItem('mr_olympia_key') || '',
            history: [],
            awaitingKey: false,

            init() {
                // Ensure key is loaded
                const stored = localStorage.getItem('mr_olympia_key');
                if (stored) this.apiKey = stored;
                console.log("Mr. Olympia Initialized");

                // Re-bind External Toggle
                const btn = document.getElementById('ai-trigger-btn');
                if (btn) {
                    // Remove old listeners (cloning is a quick hack, but careful with references)
                    // Better to just add a new one, assuming init is called once.
                    btn.onclick = (e) => {
                        e.preventDefault();
                        this.toggle();
                    };
                }
            },

            toggle() {
                const overlay = document.getElementById('chat-overlay');
                const btn = document.getElementById('ai-trigger-btn');
                const win = document.getElementById('chat-window');
                const isOpen = overlay.classList.contains('active');

                if (!isOpen) {
                    overlay.classList.add('active');
                    // Delay focus to allow transition to start
                    setTimeout(() => document.getElementById('chat-input').focus(), 100);
                    if (this.history.length === 0) {
                        this.addMessage('ai', "Greetings. I am Mr. Olympia. I am here to optimize your hypertrophy. Ask me about technique, swaps, or your current plan.");
                    }
                } else {
                    overlay.classList.remove('active');
                }
            },

            toggleSettings() {
                document.getElementById('api-settings').classList.toggle('show');
            },

            saveKey() {
                const key = document.getElementById('api-key-input').value.trim();
                if (key) {
                    this.apiKey = key;
                    localStorage.setItem('mr_olympia_key', key);
                    this.toggleSettings();
                    this.addMessage('system', "API Key saved to LocalStorage.");
                    this.awaitingKey = false;
                }
            },

            async send() {
                const input = document.getElementById('chat-input');
                const text = input.value.trim();
                if (!text) return;

                input.value = '';
                this.addMessage('user', text);

                // 1. Intercept explicit key patterns
                if (text.startsWith('sk-') || text.startsWith('AIza')) {
                    this.apiKey = text;
                    localStorage.setItem('mr_olympia_key', text);
                    this.addMessage('system', 'API Key detected and saved.');
                    this.awaitingKey = false;
                    return;
                }

                // 2. Handle "Awaiting Key" state
                if (this.awaitingKey) {
                    this.apiKey = text;
                    localStorage.setItem('mr_olympia_key', text);
                    this.addMessage('system', 'API Key saved. You can now ask questions.');
                    this.awaitingKey = false;
                    return;
                }

                // 3. Check if key exists
                if (!this.apiKey) {
                    this.addMessage('ai', "I need an API Key to function. Please paste your OpenAI (sk-...) or Google Gemini (AIza...) API key below.");
                    this.awaitingKey = true;
                    return;
                }

                this.showTyping();

                try {
                    // Context Preparation
                    const dayTitle = document.getElementById('day-title') ? document.getElementById('day-title').innerText : "Training";
                    const dayFocus = document.getElementById('theme-text') ? document.getElementById('theme-text').innerText : "General";

                    const systemPrompt = `You are Mr. Olympia, an elite, evidence-based hypertrophy coach.
You are embedded in a specific training app. 
Current Context:
- User is currently viewing: ${dayTitle}
- Day Focus: ${dayFocus}
- Full Program Data: ${JSON.stringify(DATA)}

Rules:
1. Be concise, motivating, and strictly scientific.
2. No 'bro-science'. Use terms like 'Stimulus-to-Fatigue', 'Lengthened Position', 'RIR'.
3. If asked about swaps, suggest biomechanically similar movements.
4. You value intensity. Remind the user about controlling eccentrics.
`;

                    // BRANCH: Google Gemini API
                    if (this.apiKey.startsWith('AIza')) {
                        // Gemini requires strict User -> Model -> User alternation
                        // We must sanitize history to prevent [User, User] sequences (common after errors)
                        const sanitizedHistory = [];
                        const rawHistory = this.history.filter(h => h.role !== 'system');

                        let lastRole = null;

                        for (const msg of rawHistory) {
                            const role = msg.role === 'ai' ? 'model' : 'user';
                            if (role === lastRole && role === 'user') {
                                // Merge consecutive user messages (or drop previous if acceptable, but merging is safer)
                                sanitizedHistory[sanitizedHistory.length - 1].parts[0].text += "\n" + msg.text;
                            } else if (role === lastRole && role === 'model') {
                                // Merge consecutive model messages
                                sanitizedHistory[sanitizedHistory.length - 1].parts[0].text += "\n" + msg.text;
                            } else {
                                sanitizedHistory.push({ role, parts: [{ text: msg.text }] });
                                lastRole = role;
                            }
                        }

                        // Ensure we don't end with 'model' (shouldn't happen as we trigger on user action, but safety first)
                        // Actually, we are appending the *current* user message next.
                        // So the history MUST end with 'model' (or be empty) if we append 'user'.
                        // Wait, if last was 'user', and we add 'user', we merge.

                        // Let's just construct the full payload including current text
                        const currentMsg = { role: 'user', parts: [{ text: text }] };

                        // Check if we need to merge current with last history item
                        if (sanitizedHistory.length > 0 && sanitizedHistory[sanitizedHistory.length - 1].role === 'user') {
                            sanitizedHistory[sanitizedHistory.length - 1].parts[0].text += "\n" + text;
                        } else {
                            sanitizedHistory.push(currentMsg);
                        }

                        // Use generic 'flash-latest' to ensure valid model + free tier access
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent?key=${this.apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                system_instruction: { parts: [{ text: systemPrompt }] },
                                contents: sanitizedHistory
                            })
                        });

                        const data = await response.json();
                        if (data.error) throw new Error(data.error.message);

                        this.hideTyping();
                        const reply = data.candidates[0].content.parts[0].text;
                        this.addMessage('ai', reply);

                    } else {
                        // BRANCH: OpenAI API (Default)
                        const response = await fetch('https://api.openai.com/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.apiKey}`
                            },
                            body: JSON.stringify({
                                model: "gpt-4o",
                                messages: [
                                    { role: "system", content: systemPrompt },
                                    ...this.history.filter(h => h.role !== 'system').map(h => ({ role: h.role === 'ai' ? 'assistant' : 'user', content: h.text })),
                                    { role: "user", content: text }
                                ],
                                temperature: 0.7
                            })
                        });

                        const data = await response.json();
                        if (data.error) throw new Error(data.error.message);

                        this.hideTyping();
                        const reply = data.choices[0].message.content;
                        this.addMessage('ai', reply);
                    }

                } catch (e) {
                    this.hideTyping();
                    this.addMessage('system', `Error: ${e.message}. Please check your API Key.`);
                }
            },

            addMessage(role, text) {
                this.history.push({ role, text });
                const div = document.createElement('div');
                div.className = `chat-message ${role}`;
                // Basic markdown-ish formatting
                let formatted = text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>');
                div.innerHTML = formatted;

                const body = document.getElementById('chat-body');
                body.appendChild(div);
                body.scrollTop = body.scrollHeight;
            },

            showTyping() {
                const div = document.createElement('div');
                div.id = 'typing-indicator';
                div.className = 'chat-message ai';
                div.innerHTML = '<span style="animation: pulse 1s infinite">Thinking...</span>';
                document.getElementById('chat-body').appendChild(div);
                document.getElementById('chat-body').scrollTop = document.getElementById('chat-body').scrollHeight;
            },

            hideTyping() {
                const el = document.getElementById('typing-indicator');
                if (el) el.remove();
            }
        };

        const DATA = [
            {
                id: 'push-a', accent: 'accent-push-a',
                title: 'Push A', subtitle: 'Quad Bias + Chest Development',
                focusLabel: "Today's Focus", focusText: 'High-frequency quad training with compound pressing movements.',
                exercises: [
                    {
                        name: 'Pendulum Squat', sets: '3×6-10', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Place feet low on platform at shoulder width', 'Unrack and descend slowly (3-4 seconds)', 'Drive knees forward over toes as deep as possible', 'Drive up through mid-foot, stopping short of lockout'],
                        mistakes: ['Cutting depth (ego lifting)', 'Allowing heels to rise off platform', 'Locking knees at the top (removes tension from quads)'],
                        visualization: 'The Piston Cue',
                        vizText: 'Imagine your femurs are pistons compressing a giant spring at the bottom. The goal is to close the angle between your calf and hamstring as much as possible.',
                        proTip: 'By not locking out, you induce "vascular occlusion" (the burn), forcing the Type II fibers to activate earlier in the set.'
                    },
                    {
                        name: 'Low Incline DB Press', sets: '3×6-10', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Retract scapula slightly into the bench', 'Lower dumbbells with elbows tucked at ~45°', 'Lower deep until dumbbells touch the outer chest fibers', 'Press up and slightly inward, but do not touch weights together'],
                        mistakes: ['Flaring elbows to 90° (shoulders take over)', 'Bouncing at the bottom', 'Pressing straight up (missing the adduction function of the pec)'],
                        visualization: 'The "Bicep to Pec" Cue',
                        vizText: "Don't think about pushing the dumbbells up. Instead, think about trying to touch your inner bicep to your pectorals.",
                        proTip: 'A 15° incline is biomechanically superior for "upper chest" for many people than 45° because it aligns better with the clavicular fibers without excessive front delt dominance.'
                    },
                    {
                        name: 'Cable Lateral Raise', sets: '3×10-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Set cables to wrist height behind you or between legs', 'Cross cables (left hand grabs right cable)', 'Raise arms out and away toward the walls', 'Stop when arms are parallel to the floor'],
                        mistakes: ['Shrugging (traps engaging)', 'Swinging the torso', 'Keeping arms perfectly straight (keep a soft bend)'],
                        visualization: 'Reaching for the Walls',
                        vizText: "Imagine you're standing in a narrow hallway and trying to touch the walls on either side of you. You're sweeping out, not lifting up.",
                        proTip: 'The "cross body" setup places the side delt in a fully stretched position at the start. Initiate the movement slowly to avoid jerking out of this stretch.'
                    },
                    {
                        name: 'Cable Flys', sets: '2×10-15', rir: '0', rirClass: 'intense', rest: '2:00',
                        technique: ['Set pulleys at chest height', 'Step forward, keep chest high', 'Open arms wide, letting elbows travel behind torso', 'Squeeze hands together (imagine hugging a tree)'],
                        mistakes: ['Turning it into a press (bending elbows too much)', 'Clanging handles together (loss of tension)', 'Rounding shoulders forward at the contraction'],
                        visualization: 'The Barrel Hug',
                        vizText: "Imagine you're hugging a massive oak tree. Your elbows must stay fixed in a slightly bent position.",
                        proTip: "Pause for a full second in the stretched position (arms back). This is where hypertrophy signaling is highest. Don't worry about touching hands at the top; the tension drops off there anyway."
                    },
                    {
                        name: 'Overhead Extension', sets: '2×10-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Set pulley at hip height, face away', 'Keep elbows near ears/head', 'Extend arms overhead, separating the rope', 'Control the lowering phase completely'],
                        mistakes: ['Letting elbows flare too wide', 'Arching the lower back to help move weight', 'Shortening the range (not going deep enough behind head)'],
                        visualization: 'Throwing the Ball',
                        vizText: 'Visualize throwing a heavy medicine ball directly over your head to someone standing behind you.',
                        proTip: 'At the very top, turn your wrists out (pronate). This fully shortens the tricep. However, the money is in the stretch—let the rope pull your hands deep behind your neck.'
                    }
                ]
            },
            {
                id: 'pull-a', accent: 'accent-pull-a',
                title: 'Pull A', subtitle: 'Hinge Bias + Lat Width',
                focusLabel: "Today's Focus", focusText: 'Posterior Chain Loading & Vertical Pulling.',
                exercises: [
                    {
                        name: 'Romanian Deadlift', sets: '3×6-8', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Stand shoulder width, unlock knees (slight bend)', 'Hinge exclusively at the hips (push butt back)', 'Slide bar down thighs/shins', 'Stop when hips stop moving back, squeeze glutes to return'],
                        mistakes: ['"Squatting" the weight (too much knee bend)', 'Rounding the lumbar spine', 'Going too low (flexing spine instead of hips)'],
                        visualization: 'Car Door',
                        vizText: 'Imagine your hands are full of groceries and you have to close a car door behind you using only your butt. Push back, back, back.',
                        proTip: 'Range of motion is determined by your hamstring flexibility. The moment your hips stop traveling backward, the rep is over. Going lower just transfers tension to your lower back.'
                    },
                    {
                        name: 'Weighted Pull-Up', sets: '3×6-10', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Use a neutral grip (palms facing each other)', 'Depress shoulders (reverse shrug) before bending elbows', 'Pull chest to bar', 'Lower under control'],
                        mistakes: ['Kipping/swinging', 'Rolling shoulders forward at the top', 'Not going to full hang'],
                        visualization: 'Elbows to Pockets',
                        vizText: "Don't think about pulling your body up. Visualize driving your elbows down into your back pockets.",
                        proTip: 'The neutral grip biases the lats and brachialis while being safer on the shoulders. If you cannot do weighted, do bodyweight or assisted, but keep the rep range low (6-10) to stimulate mechanical tension.'
                    },
                    {
                        name: 'Reverse Pec Deck', sets: '2×12-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Adjust seat so handles are at shoulder height', 'Push handles back with the back of your hands', 'Keep arms slightly bent but rigid', 'Stop when arms are in line with the body'],
                        mistakes: ['Squeezing shoulder blades together (traps take over)', 'Using a "rowing" motion', 'Excessive momentum'],
                        visualization: 'Pushing Walls Away',
                        vizText: "Imagine you're in a shrinking room and you're pushing the walls away with the backs of your hands.",
                        proTip: 'We want to isolate the rear delt. If you squeeze your shoulder blades (scapular retraction), the traps take over. Keep your shoulder blades wide and immobile; move only the arm bone (humerus).'
                    },
                    {
                        name: 'Chest-Supported Row', sets: '3×8-12', rir: '1-2', rirClass: 'controlled', rest: '2:00',
                        technique: ['Glue chest to the pad', 'Use a pronated (overhand) or wide neutral grip', 'Protract (stretch) shoulders at bottom', 'Retract (squeeze) shoulders at top'],
                        mistakes: ['Lifting chest off pad to use momentum', 'Pulling with biceps (curling the weight)', 'Neck-cranking (looking up too high)'],
                        visualization: 'Wrap Around the Pad',
                        vizText: 'At the bottom, let the weight pull your shoulders forward so you feel your back "wrapping around" the pad. At the top, crack a walnut between your shoulder blades.',
                        proTip: 'This is for upper back (rhomboids/traps/rear delts). Unlike the pull-up (lats), here we want the shoulder blades to move dynamically.'
                    },
                    {
                        name: 'Incline DB Curls', sets: '2×10-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Set bench to 45-60°', 'Lay back, let arms hang perpendicular to floor', 'Curl up while keeping elbows pointed at floor', 'Supinate (twist pinky up) at the top'],
                        mistakes: ['Swinging elbows forward (front delt help)', 'Lifting head off bench', 'Not fully extending arm at bottom'],
                        visualization: 'Elbows in Cement',
                        vizText: 'Imagine your elbows are encased in cement blocks fixed to the floor. They can hinge, but they cannot move forward, backward, or sideways.',
                        proTip: "This targets the 'long head' of the biceps via the stretch. The stretch is the most anabolic part of this movement—don't cut the bottom short."
                    }
                ]
            },
            {
                id: 'push-b', accent: 'accent-push-b',
                title: 'Push B', subtitle: 'Quad Isolation + Upper Chest Focus',
                focusLabel: "Today's Focus", focusText: 'Pre-Exhausting Quads + Vertical Pressing.',
                exercises: [
                    {
                        name: 'Leg Extension', sets: '3×10-15', rir: '0', rirClass: 'intense', rest: '2:00',
                        technique: ['Align knee joint with machine pivot point', 'Dorsiflex ankles (pull toes toward shins)', 'Kick up and hold for 1 second at the top', 'Lower slowly (3-second eccentric)'],
                        mistakes: ['Kicking explosively (momentum)', 'Butt coming off the seat', 'Partial reps at the bottom'],
                        visualization: 'The "Glue" Cue',
                        vizText: "Imagine your butt is super-glued to the seat. If you have to lift your hips to move the weight, it's too heavy.",
                        proTip: "Dorsiflexing the toes (pulling them up) reduces calf involvement and increases rectus femoris activation. This is your only direct rectus femoris work (squats don't hit it well)."
                    },
                    {
                        name: 'Seated OHP', sets: '3×6-10', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Set bench to 75-80° (not fully 90°)', 'Lower bar/handles to chin level', 'Press vertically, finishing with biceps by ears', 'Control the descent'],
                        mistakes: ['Arching back into a chest press', 'Cutting ROM (stopping at forehead)', 'Flaring elbows completely to sides (unsafe for rotator cuff)'],
                        visualization: 'Head Through Window',
                        vizText: 'As you press up, imagine pushing your head slightly forward "through the window" created by your arms (without moving your torso).',
                        proTip: 'Using a machine or Smith here is preferred over free weights for hypertrophy, as stability requirements are lower, allowing you to grind closer to failure safely.'
                    },
                    {
                        name: 'Machine Lateral Raise', sets: '3×10-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Place elbows against pads', 'Keep chest supported against the pad', 'Drive elbows up/out leading the movement', 'Lower with resistance'],
                        mistakes: ['Gripping the handles too tight (activates forearms)', 'Shrugging shoulders up'],
                        visualization: 'Puppet Strings',
                        vizText: 'Imagine strings are attached to your elbows, pulling them up to the ceiling. Your hands are just hooks; they do no work.',
                        proTip: "This is an 'active rest' for your triceps and chest before the next heavy press. Keep your traps relaxed and depressed."
                    },
                    {
                        name: 'High Incline Smith Press', sets: '3×8-12', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Set bench to 45°', 'Lower bar toward the clavicle (upper chest/neck base)', 'Pause briefly on the chest', 'Press up to 90% lockout'],
                        mistakes: ['Lowering to the nipple line (too low for 45°)', 'Bouncing off the chest', 'Elbows flaring too wide (shoulder impingement risk)'],
                        visualization: 'Scraping the Chin',
                        vizText: "The bar path is fixed. You must position your body so the bar feels like it's almost going to scrape your chin on the way down. This isolates the clavicular (upper) pec.",
                        proTip: 'Since your front delts are fatigued from the OHP, your stabilizers are shot. The Smith machine is crucial here to allow you to safely push the upper pecs to failure without dropping the weight.'
                    },
                    {
                        name: 'Triceps Pushdown', sets: '2×10-15', rir: '0', rirClass: 'intense', rest: '60s',
                        technique: ['Pin elbows to your ribcage', 'Hinge only at the elbow', 'Pull the rope apart at the bottom', 'Squeeze triceps hard'],
                        mistakes: ['Shoulders rolling forward / leaning on the rope', 'Moving the elbows forward and back', 'Using momentum'],
                        visualization: 'Breaking the Rope',
                        vizText: "Don't just push down. Visualize trying to rip the rope in half as you reach the bottom of the movement.",
                        proTip: "This targets the lateral and medial heads of the triceps. Keep the tempo strict. If your shoulders roll forward, you're using your chest—drop the weight."
                    }
                ]
            },
            {
                id: 'pull-b', accent: 'accent-pull-b',
                title: 'Pull B', subtitle: 'Hamstring Isolation + Upper Back Bias',
                focusLabel: "Today's Focus", focusText: 'Shortened Position Hamstrings + Horizontal Pulling.',
                exercises: [
                    {
                        name: 'Lat Pulldown', sets: '3×8-12', rir: '1-2', rirClass: 'controlled', rest: '2:00',
                        technique: ['Lock thighs under pad tightly', 'Keep torso relatively upright (slight lean okay)', 'Drive elbows down towards hips', 'Control the ascent to full stretch'],
                        mistakes: ['Leaning back too far (turns into a row)', 'Using momentum to start the pull', 'Shrugging at the ears'],
                        visualization: 'Dragging the Wall',
                        vizText: 'Visualize your elbows dragging down along a wall behind you.',
                        proTip: 'Use lifting straps here. Taking your grip strength out of the equation allows you to push the lats to true failure without your forearms giving out first.'
                    },
                    {
                        name: 'Seated Leg Curl', sets: '3×10-15', rir: '0', rirClass: 'intense', rest: '2:00',
                        technique: ['Align knee with pivot', 'Lock the thigh pad down hard onto legs', 'Drive heels back and under', 'Control the eccentric release (3 seconds)'],
                        mistakes: ['Hips lifting off the seat (cheating)', 'Dorsiflexing toes (keep ankles relaxed or neutral)', 'Bouncing out of the stretched position'],
                        visualization: 'Digging a Trench',
                        vizText: "Imagine you're trying to dig a trench in the ground using your heels.",
                        proTip: 'The seated curl places the hamstrings in a lengthened position (because the hips are flexed). This makes it superior to the lying leg curl for hypertrophy. Grip the handles tight to brace yourself into the seat.'
                    },
                    {
                        name: 'Wide Grip Cable Row', sets: '3×10-12', rir: '1-2', rirClass: 'controlled', rest: '2:00',
                        technique: ['Use a wide mag-grip or straight bar', 'Keep torso upright (minimal sway)', 'Pull elbows high and wide (shoulder height)', 'Squeeze scapula together'],
                        mistakes: ['Pulling elbows into sides (hits lats, not upper back)', 'Rounding the back (spine safety)', 'Excessive leaning back'],
                        visualization: 'Scarecrow Pull',
                        vizText: 'Pull your elbows apart like a scarecrow. The goal is width.',
                        proTip: 'By flaring the elbows out to 45-60 degrees, you bias the upper back (traps, rhomboids, rear delts) rather than the lats.'
                    },
                    {
                        name: 'Face Pulls', sets: '2×15-20', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Set rope to upper chest height', 'Grasp rope with thumbs facing back (hammer grip)', 'Pull towards forehead while spreading hands', 'Externally rotate (hands finish behind ears)'],
                        mistakes: ['Pulling to the chin/neck', 'Keeping hands close together', 'Using bodyweight to pull'],
                        visualization: 'Double Bicep Pose',
                        vizText: 'Finish the movement in a "double bicep" pose. Your knuckles should be facing the wall behind you.',
                        proTip: 'This is not a heavy strength movement. It\'s for rotator cuff health and rear delts. If you go too heavy, your internal rotators (pecs/lats) will take over, defeating the purpose.'
                    },
                    {
                        name: 'Preacher Curl', sets: '2×10-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Adjust seat so armpit fits snugly over pad', 'Extend arm fully', 'Curl weight without moving the upper arm', 'Squeeze biceps at the top'],
                        mistakes: ['Leaning back to gain leverage', 'Lifting elbows off the pad', 'Stopping short of full extension'],
                        visualization: 'The Hinge',
                        vizText: 'Your arm is a simple hinge. Nothing else in the body moves.',
                        proTip: 'This exercises the biceps in the "shortened position." However, be careful at the very bottom (full extension)—the load is high there. Control the negative to avoid tendon strain.'
                    }
                ]
            }
        ];

        const App = {
            state: { day: 0, completed: {}, timerInterval: null, timerSeconds: 0 },

            init() {
                // Set theme based on system preference (default to dark if no preference)
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (!prefersDark) {
                    // Check if user has explicitly set light mode elsewhere or default to system
                    // Here we act on system preference. HTML body has data-theme="dark" by default.
                    document.body.setAttribute('data-theme', 'light');
                } else {
                    document.body.setAttribute('data-theme', 'dark');
                }

                this.cache();

                // Fix: Ensure we start at top with full header
                this.el.container.scrollTop = 0;
                this.el.header.classList.remove('scrolled');

                this.bind();

                // Fix: Ensure nav state matches initial state
                this.updateNav(this.state.day);
                this.render(this.state.day);

                // Initialize MrOlympia
                MrOlympia.init();
            },

            cache() {
                this.el = {
                    container: document.getElementById('app-container'),
                    header: document.getElementById('header'),
                    dayTitle: document.getElementById('day-title'),
                    daySubtitle: document.getElementById('day-subtitle'),
                    themeLabel: document.getElementById('theme-label'),
                    themeText: document.getElementById('theme-text'),
                    progressFill: document.getElementById('progress-fill'),
                    progressContainer: document.getElementById('progress-container'),
                    cardList: document.getElementById('card-list'),
                    navItems: document.querySelectorAll('.nav-item'),
                    themeToggle: document.getElementById('theme-toggle'),
                    themeIcon: document.getElementById('theme-icon'),
                    timerOverlay: document.getElementById('timer-overlay'),
                    timerDisplay: document.getElementById('timer-display'),
                    timerBtn: document.getElementById('timer-btn'),
                    // aiTrigger: document.getElementById('mr-olympia-btn'), // Removed, now handled by MrOlympia.init()
                    liquidBg: document.getElementById('liquid-bg')
                };
            },

            bind() {
                // Bug fix: Debounced scroll listener to prevent header jumping
                let scrollTimeout = null;
                let lastScrollState = false;

                this.el.container.addEventListener('scroll', () => {
                    const shouldBeScrolled = this.el.container.scrollTop > 10;

                    // Only update if state actually changed
                    if (shouldBeScrolled !== lastScrollState) {
                        // Clear any pending timeout
                        if (scrollTimeout) clearTimeout(scrollTimeout);

                        // Debounce the class toggle
                        scrollTimeout = setTimeout(() => {
                            if (shouldBeScrolled) {
                                this.el.header.classList.add('scrolled');
                            } else {
                                this.el.header.classList.remove('scrolled');
                            }
                            lastScrollState = shouldBeScrolled;
                        }, 50); // 50ms debounce
                    }
                }, { passive: true });

                // Nav items
                this.el.navItems.forEach(item => {
                    item.addEventListener('click', () => this.goToDay(+item.dataset.day));
                });

                // Theme toggle
                this.el.themeToggle.addEventListener('click', () => this.toggleTheme());

                // Timer
                this.el.timerBtn.addEventListener('click', () => this.stopTimer());
                this.el.timerOverlay.addEventListener('click', e => {
                    if (e.target === this.el.timerOverlay) this.stopTimer();
                });

                // EVENT DELEGATION for card interactions (iOS Safari fix)
                // Replaces inline onclick handlers that fail on iOS due to HTML entity encoding
                this.el.cardList.addEventListener('click', (e) => {
                    const card = e.target.closest('.card');
                    if (!card) return;

                    const checkbox = e.target.closest('.checkbox-wrapper');
                    const restBadge = e.target.closest('.rest-badge');

                    if (checkbox) {
                        e.stopPropagation();
                        this.toggleComplete(e, card.id);
                    } else if (restBadge) {
                        e.stopPropagation();
                        const time = restBadge.textContent.trim();
                        this.startTimer(e, time);
                    } else {
                        this.toggleCard(card.id);
                    }
                });

                // Keyboard accessibility for cards
                this.el.cardList.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        const card = e.target.closest('.card');
                        if (card && e.target === card) {
                            e.preventDefault();
                            this.toggleCard(card.id);
                        }
                    }
                });

                // Swipe
                let startX = 0;
                this.el.container.addEventListener('touchstart', e => startX = e.touches[0].clientX, { passive: true });
                this.el.container.addEventListener('touchend', e => {
                    const dx = startX - e.changedTouches[0].clientX;
                    if (Math.abs(dx) > 60) {
                        if (dx > 0 && this.state.day < 3) this.goToDay(this.state.day + 1);
                        else if (dx < 0 && this.state.day > 0) this.goToDay(this.state.day - 1);
                    }
                }, { passive: true });
            },

            toggleTheme() {
                const current = document.body.getAttribute('data-theme');
                const next = current === 'dark' ? 'light' : 'dark';
                document.body.setAttribute('data-theme', next);

                // Update icon
                if (next === 'dark') {
                    this.el.themeIcon.innerHTML = '<path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>';
                } else {
                    this.el.themeIcon.innerHTML = '<path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1z"/>';
                }
            },

            goToDay(index) {
                if (index === this.state.day) return;

                // Update nav
                this.updateNav(index);
                this.state.day = index;

                // UX: Show skeleton loading state
                this.el.cardList.classList.add('loading');

                // Fade out
                this.el.cardList.style.opacity = '0';
                this.el.cardList.style.transform = 'translateY(16px)';

                setTimeout(() => {
                    this.render(index);
                    this.el.cardList.classList.remove('loading');
                    this.el.cardList.style.opacity = '1';
                    this.el.cardList.style.transform = 'translateY(0)';
                    this.el.container.scrollTop = 0;
                }, 250);
            },

            render(index) {
                const d = DATA[index];

                // Update accent
                document.body.className = d.accent;

                // Update header
                this.el.dayTitle.textContent = d.title;
                this.el.daySubtitle.textContent = d.subtitle;
                this.el.themeLabel.textContent = d.focusLabel;
                this.el.themeText.textContent = d.focusText;

                // Update progress
                this.updateProgress(d.id, d.exercises.length);

                // Render cards
                let html = '';
                d.exercises.forEach((ex, i) => {
                    const id = `${d.id}-${i}`;
                    const isCompleted = this.state.completed[id];

                    // Build technique steps list
                    const techSteps = ex.technique.map((step, idx) =>
                        `<li><span class="step-num">${idx + 1}</span>${step}</li>`
                    ).join('');

                    // Build mistakes list
                    const mistakesList = ex.mistakes.map(m =>
                        `<li><span class="mistake-icon">✗</span>${m}</li>`
                    ).join('');

                    html += `
                        <article class="card ${isCompleted ? 'completed' : ''}" id="${id}">
                            <div class="card-header">
                                <div class="exercise-order">${i + 1}</div>
                                <div class="exercise-info">
                                    <h3>${ex.name}</h3>
                                    <div class="meta-row">
                                        <span class="meta-pill accent">${ex.sets}</span>
                                        <span class="rir-chip ${ex.rirClass}">RIR ${ex.rir}</span>
                                        <span class="rest-badge">${ex.rest}</span>
                                    </div>
                                </div>
                                <div class="checkbox-wrapper">
                                    <svg class="check-icon" viewBox="0 0 24 24">
                                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="details-wrapper">
                                <div class="details-inner">
                                    <div class="glass-inner-panel">
                                        <span class="label-pill">Technique</span>
                                        <ol class="technique-list">${techSteps}</ol>
                                    </div>
                                    <div class="glass-inner-panel mistakes-panel">
                                        <span class="label-pill warning">Common Mistakes</span>
                                        <ul class="mistakes-list">${mistakesList}</ul>
                                    </div>
                                    <div class="glass-inner-panel viz-panel">
                                        <span class="label-pill accent">${ex.visualization}</span>
                                        <p class="tip-text">${ex.vizText}</p>
                                    </div>
                                    <div class="glass-inner-panel pro-panel">
                                        <span class="label-pill pro">Pro Tip</span>
                                        <p class="tip-text">${ex.proTip}</p>
                                    </div>
                                </div>
                            </div>
                        </article>
                    `;
                });
                this.el.cardList.innerHTML = html;
                this.el.cardList.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
            },

            updateProgress(dayId, total) {
                const completed = Object.keys(this.state.completed).filter(k => k.startsWith(dayId)).length;
                const percent = (completed / total) * 100;
                this.el.progressFill.style.width = percent + '%';
            },

            toggleCard(id) {
                document.getElementById(id).classList.toggle('expanded');
            },

            toggleComplete(e, id) {
                // Prevent event from bubbling to card toggle
                e.stopPropagation();
                e.preventDefault();

                // Store expanded state before any changes
                const card = document.getElementById(id);
                const wasExpanded = card.classList.contains('expanded');
                const isCompleting = !this.state.completed[id];

                // Premium haptic vibration pattern
                if (navigator.vibrate) {
                    if (isCompleting) {
                        // Success pattern: short-pause-long
                        navigator.vibrate([15, 50, 30]);
                    } else {
                        // Undo pattern: single tap
                        navigator.vibrate(10);
                    }
                }

                if (isCompleting) {
                    this.state.completed[id] = true;
                    card.classList.add('completed');
                    // Note: Visual pulse animation removed - haptic vibration provides sufficient feedback
                } else {
                    delete this.state.completed[id];
                    card.classList.remove('completed');
                }

                const d = DATA[this.state.day];
                this.updateProgress(d.id, d.exercises.length);

                // Ensure expanded state is preserved (fix for closing on complete)
                if (wasExpanded) {
                    card.classList.add('expanded');
                }
            },

            // UX: Auto-expand first incomplete exercise
            autoExpandFirstIncomplete() {
                const d = DATA[this.state.day];
                for (let i = 0; i < d.exercises.length; i++) {
                    const id = `${d.id}-${i}`;
                    if (!this.state.completed[id]) {
                        const card = document.getElementById(id);
                        if (card && !card.classList.contains('expanded')) {
                            // Delay slightly for smoother visual flow
                            setTimeout(() => {
                                card.classList.add('expanded');
                                card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }, 100);
                        }
                        break;
                    }
                }
            },

            startTimer(e, time) {
                if (e && e.stopPropagation) e.stopPropagation();

                // Fix timer parsing for formats like "90s", "2:00", "3:00"
                let seconds = 0;
                if (time.includes(':')) {
                    const parts = time.split(':');
                    seconds = parseInt(parts[0]) * 60 + parseInt(parts[1]);
                } else if (time.includes('s')) {
                    // Handle "90s" format - just seconds
                    seconds = parseInt(time);
                } else {
                    // Assume minutes
                    seconds = parseInt(time) * 60;
                }

                this.state.timerSeconds = seconds;
                this.updateTimerDisplay();
                this.el.timerOverlay.classList.add('active');

                // Focus the skip button for accessibility
                setTimeout(() => this.el.timerBtn.focus(), 100);

                // Premium haptic: light tap on timer start
                if (navigator.vibrate) navigator.vibrate([10, 30, 15]);

                this.state.timerInterval = setInterval(() => {
                    this.state.timerSeconds--;
                    this.updateTimerDisplay();
                    if (this.state.timerSeconds <= 0) this.timerDone();
                }, 1000);
            },

            updateTimerDisplay() {
                const m = Math.floor(this.state.timerSeconds / 60);
                const s = this.state.timerSeconds % 60;
                this.el.timerDisplay.textContent = `${m}:${s.toString().padStart(2, '0')}`;
            },

            timerDone() {
                this.stopTimer();
                if (navigator.vibrate) navigator.vibrate([80, 40, 80]);
            },

            stopTimer() {
                clearInterval(this.state.timerInterval);
                this.el.timerOverlay.classList.remove('active');
            },

            updateNav(index) {
                this.el.navItems.forEach(item => item.classList.remove('active'));
                if (this.el.navItems[index]) {
                    this.el.navItems[index].classList.add('active');
                }
            },

            // Save state to localStorage
            saveState() {
                try {
                    localStorage.setItem('hypertrophy-completed', JSON.stringify(this.state.completed));
                    localStorage.setItem('hypertrophy-day', this.state.day.toString());
                } catch (e) {
                    console.warn('Could not save state to localStorage:', e);
                }
            },

            // Load state from localStorage
            loadState() {
                try {
                    const saved = localStorage.getItem('hypertrophy-completed');
                    const savedDay = localStorage.getItem('hypertrophy-day');
                    if (saved) {
                        this.state.completed = JSON.parse(saved);
                    }
                    if (savedDay) {
                        this.state.day = parseInt(savedDay, 10);
                    }
                } catch (e) {
                    console.warn('Could not load state from localStorage:', e);
                }
            }
        };

        // CRITICAL FIX: Expose App to window for any remaining inline handlers
        // and for debugging/testing purposes
        window.App = App;

        const TestSuite = {
            async run() {
                console.clear();
                console.log('%c🧪 Starting Hypertrophy App Tests...', 'color: #4ecdc4; font-size: 14px; font-weight: bold;');
                let passed = 0;
                let cases = [
                    this.testInitialState,
                    this.testNavigation,
                    this.testCardToggle,
                    this.testDayCycle
                ];

                for (const test of cases) {
                    try {
                        await test.call(this);
                        passed++;
                    } catch (e) {
                        console.error(`❌ Test Failed: ${test.name}`, e);
                    }
                }

                if (passed === cases.length) {
                    console.log(`%c✅ All ${passed} tests passed!`, 'color: #4cd964; font-size: 16px; font-weight: bold;');
                    alert('All tests passed! Check console for details.');
                }
            },

            assert(condition, message) {
                if (!condition) {
                    throw new Error(message);
                }
                console.log(`%c  ✔ ${message}`, 'color: #888');
            },

            async wait(ms) {
                return new Promise(r => setTimeout(r, ms));
            },

            async testInitialState() {
                console.group('Test: Initial State');
                // Check if Day 1 is active by default
                const day1 = document.querySelector('.nav-item[data-day="0"]');
                this.assert(day1.classList.contains('active'), 'Day 1 should be active initially');

                // Check if Day 4 is NOT active
                const day4 = document.querySelector('.nav-item[data-day="3"]');
                this.assert(!day4.classList.contains('active'), 'Day 4 should NOT be active');

                // Check Title
                const title = document.getElementById('day-title').textContent;
                this.assert(title === 'Push A', 'Title should be "Push A"');
                console.groupEnd();
            },

            async testNavigation() {
                console.group('Test: Navigation');

                // Click Day 2
                App.goToDay(1);
                await this.wait(600); // Wait for transition
                const day2 = document.querySelector('.nav-item[data-day="1"]');
                const title = document.getElementById('day-title').textContent;

                this.assert(day2.classList.contains('active'), 'Day 2 should be active after click');
                this.assert(title === 'Pull A', 'Title should change to "Pull A"');

                // Check invalid dual highlight
                const day1 = document.querySelector('.nav-item[data-day="0"]');
                this.assert(!day1.classList.contains('active'), 'Day 1 should NOT be active anymore');

                // Return to Day 1
                App.goToDay(0);
                await this.wait(600);
                console.groupEnd();
            },

            async testCardToggle() {
                console.group('Test: Card Interactions');
                // Target first card
                const card = document.getElementById('push-a-0');

                // Reset if already expanded
                if (card.classList.contains('expanded')) card.classList.remove('expanded');

                // Simulate click
                card.click();
                await this.wait(100);
                this.assert(card.classList.contains('expanded'), 'Card should expand on click');

                // Simulate click again
                card.click();
                await this.wait(100);
                this.assert(!card.classList.contains('expanded'), 'Card should collapse on second click');
                console.groupEnd();
            },

            async testDayCycle() {
                console.group('Test: Full Cycle');
                for (let i = 0; i < 4; i++) {
                    App.goToDay(i);
                    await this.wait(400);
                    const nav = document.querySelector(`.nav-item[data-day="${i}"]`);
                    this.assert(nav.classList.contains('active'), `Day ${i + 1} activated`);
                }
                // Reset
                App.goToDay(0);
                console.groupEnd();
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>


</body>

</html>
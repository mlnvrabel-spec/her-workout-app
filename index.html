<!DOCTYPE html>
<!-- saved from url=(0095)file:///C:/Users/mlnvr/Desktop/Antigravity/Workout%20Split%20Dashboard/Workout%20Dashboard.html -->
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <title>Training</title>

    <!-- =============================================
         PWA / HOME SCREEN ICON CONFIGURATION
         ============================================= -->
    <!-- Android: Enables "Add to Home Screen" without address bar -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0d0d14">
    <meta name="application-name" content="Training">

    <!-- iOS: Enables standalone mode (no Safari UI) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Training">

    <!-- FAVICON & APP ICON (Using user-provided SVG path) -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 612 792%22><path fill=%22%237038FF%22 d=%22M0 215.82c23.25-63.53 67.4-133.95 118.49-158.59 27.51-13.27 62.13 4.55 63.02 33.16.88 27.73-11.9 26.52-13.8 52.12-1.56 21.07 11.96 32.1 18.15 47.4 9.5 23.45.16 70.17-17.61 85.54-24.79 21.46-77.98 2.07-73.64 44.63 2.28 22.35 20.13 38.13 35.05 53.95 31.09 32.96 55.11 28.91 96.71 23.93 19.09-2.29 22.06-31.49 33.26-46.17-5.97-7.46-11.21-17.37-11.77-32.7-.9-24.78 20.02-46.91 38.81-56.29-1.93-13.77 1.6-28.46 9.59-40.22 14.73-21.69 38.71-25.5 61.59-24.39 18.19.88 36.26 4.94 53.28 12.02 24.51 10.18 47.77 48.13 51.81 69.39 3.48 18.33 4.58 45.17-.35 63.82-3.49 13.17-9.97 33.58-28.4 43.32 1.49 1.59 10.01 9.51 14.14 12.81 14.33-2.89 33.63 3.23 47.86 6.5 9.96 2.29 49.39-28.07 48.96-40.44-.47-13.76 18.76-28.04 35.37-35.09 25.34-10.76 68.19-7.46 72.32 31.97 2.94 28.08-16.2 37.21-26.48 43.71-7.14 4.5-14.7 10.43-15.67 17.51-.53 3.83 3.85 6.22 6.81 9.77 36.42 43.6 54.23 126.84 53.64 185.09-.25 25.2-3.95 33.42-9.9 43.88-11.63 20.45-25.79 50.76 55.02-12.31 3.37-57.64 25.88-56.81 48.62.63 17.32 31.15 31.58 26.03 55.41-5.02 23.38-21.77 48.8-49.87 55.97-14.67 3.74-103.03 78.57-142.42 82.43-21.96 2.15-49.54 7.29-69.76 11.59-42.53 9.04-79.68 8.3-103.58 2.45-6.08-1.49-17.12-8.21-17.12-8.21v-219.9c-18.11-19.82-11.33-113.95-13.3-120.22-5.58-17.84-14.37-34.8-22.34-51.56-23.99-50.47-49.28-97.12-111.76-137.33-10.78-6.93-41.59-32.51-42.42-34.21-1.89-3.88-2.43-25.48-2.43-29.86v-87.48z%22/></svg>">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 612 792%22><rect width=%22612%22 height=%22792%22 fill=%22%230d0d14%22/><path fill=%22%237038FF%22 d=%22M0 215.82c23.25-63.53 67.4-133.95 118.49-158.59 27.51-13.27 62.13 4.55 63.02 33.16.88 27.73-11.9 26.52-13.8 52.12-1.56 21.07 11.96 32.1 18.15 47.4 9.5 23.45.16 70.17-17.61 85.54-24.79 21.46-77.98 2.07-73.64 44.63 2.28 22.35 20.13 38.13 35.05 53.95 31.09 32.96 55.11 28.91 96.71 23.93 19.09-2.29 22.06-31.49 33.26-46.17-5.97-7.46-11.21-17.37-11.77-32.7-.9-24.78 20.02-46.91 38.81-56.29-1.93-13.77 1.6-28.46 9.59-40.22 14.73-21.69 38.71-25.5 61.59-24.39 18.19.88 36.26 4.94 53.28 12.02 24.51 10.18 47.77 48.13 51.81 69.39 3.48 18.33 4.58 45.17-.35 63.82-3.49 13.17-9.97 33.58-28.4 43.32 1.49 1.59 10.01 9.51 14.14 12.81 14.33-2.89 33.63 3.23 47.86 6.5 9.96 2.29 49.39-28.07 48.96-40.44-.47-13.76 18.76-28.04 35.37-35.09 25.34-10.76 68.19-7.46 72.32 31.97 2.94 28.08-16.2 37.21-26.48 43.71-7.14 4.5-14.7 10.43-15.67 17.51-.53 3.83 3.85 6.22 6.81 9.77 36.42 43.6 54.23 126.84 53.64 185.09-.25 25.2-3.95 33.42-9.9 43.88-11.63 20.45-25.79 50.76 55.02-12.31 3.37-57.64 25.88-56.81 48.62.63 17.32 31.15 31.58 26.03 55.41-5.02 23.38-21.77 48.8-49.87 55.97-14.67 3.74-103.03 78.57-142.42 82.43-21.96 2.15-49.54 7.29-69.76 11.59-42.53 9.04-79.68 8.3-103.58 2.45-6.08-1.49-17.12-8.21-17.12-8.21v-219.9c-18.11-19.82-11.33-113.95-13.3-120.22-5.58-17.84-14.37-34.8-22.34-51.56-23.99-50.47-49.28-97.12-111.76-137.33-10.78-6.93-41.59-32.51-42.42-34.21-1.89-3.88-2.43-25.48-2.43-29.86v-87.48z%22/></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,100..900&display=swap" rel="stylesheet">
    <style>
        /* ========================================
           CSS VARIABLES & THEME CONFIGURATION
           ======================================== */
        :root {
            /* Geometry */
            --radius-xl: 28px;
            --radius-lg: 20px;
            --radius-sm: 12px;
            --space-xs: 8px;
            --space-sm: 16px;
            --space-md: 24px;
            --space-lg: 32px;
            --nav-height: 80px;

            /* Animation - Studio 2026: Sub-300ms micro-interactions */
            --ease-fluid: cubic-bezier(0.22, 1, 0.36, 1);
            --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --duration-micro: 180ms;
            --duration-fast: 250ms;
            --duration-normal: 350ms;

            /* Typography - Studio 2026: Fluid with clamp() */
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --text-xs: clamp(0.625rem, 0.5rem + 0.5vw, 0.75rem);
            --text-sm: clamp(0.75rem, 0.65rem + 0.5vw, 0.875rem);
            --text-base: clamp(0.875rem, 0.8rem + 0.4vw, 1rem);
            --text-lg: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
            --text-xl: clamp(1.125rem, 1rem + 0.6vw, 1.375rem);
            --text-2xl: clamp(1.5rem, 1.2rem + 1.5vw, 2rem);
            --text-hero: clamp(2.25rem, 1.8rem + 2.5vw, 3rem);
        }

        /* DARK THEME (Default) - Studio 2026: oklch() color space */
        [data-theme="dark"] {
            --bg-color: oklch(5% 0.01 270);
            --bg-gradient: radial-gradient(ellipse at 0% 0%, oklch(18% 0.04 260) 0%, oklch(5% 0.01 270) 50%);

            --text-primary: oklch(100% 0 0);
            --text-secondary: oklch(85% 0 0 / 0.7);
            --text-tertiary: oklch(75% 0 0 / 0.45);

            /* Glass Surfaces - Glassmorphism 2.0 with depth layers */
            --glass-surface: oklch(100% 0 0 / 0.04);
            --glass-surface-strong: oklch(100% 0 0 / 0.08);
            --glass-surface-elevated: oklch(100% 0 0 / 0.12);
            --glass-border: oklch(100% 0 0 / 0.1);
            --glass-highlight: oklch(100% 0 0 / 0.2);
            --glass-shadow:
                0 4px 16px oklch(0% 0 0 / 0.3),
                0 12px 40px oklch(0% 0 0 / 0.4);
            --glass-shadow-elevated:
                0 8px 24px oklch(0% 0 0 / 0.4),
                0 20px 60px oklch(0% 0 0 / 0.5);

            /* Navigation */
            --nav-glass: oklch(100% 0 0 / 0.03);
            --nav-text: oklch(100% 0 0);
            --nav-active-pill: oklch(100% 0 0 / 0.15);

            /* Muscle Map Silhouette */
            --muscle-fill: rgba(255, 255, 255, 0.15);
            --muscle-stroke: rgba(255, 255, 255, 0.2);
        }

        /* LIGHT THEME - Studio 2026: oklch() color space */
        [data-theme="light"] {
            --bg-color: oklch(97% 0.005 270);
            --bg-gradient: radial-gradient(ellipse at 100% 0%, oklch(94% 0.015 250) 0%, oklch(100% 0 0) 70%);

            --text-primary: oklch(15% 0.01 270);
            --text-secondary: oklch(35% 0.01 270 / 0.7);
            --text-tertiary: oklch(45% 0.01 270 / 0.5);

            /* Glass Surfaces - Glassmorphism 2.0 */
            --glass-surface: oklch(100% 0 0 / 0.75);
            --glass-surface-strong: oklch(100% 0 0 / 0.9);
            --glass-surface-elevated: oklch(100% 0 0 / 0.95);
            --glass-border: oklch(100% 0 0 / 0.9);
            --glass-highlight: oklch(100% 0 0);
            --glass-shadow:
                0 4px 12px oklch(0% 0 0 / 0.04),
                0 8px 24px oklch(0% 0 0 / 0.06);
            --glass-shadow-elevated:
                0 8px 20px oklch(0% 0 0 / 0.06),
                0 16px 40px oklch(0% 0 0 / 0.08);

            /* Navigation */
            --nav-glass: oklch(100% 0 0 / 0.85);
            --nav-text: oklch(15% 0.01 270);
            --nav-active-pill: oklch(0% 0 0 / 0.08);

            /* Muscle Map Silhouette - darker for light backgrounds */
            --muscle-fill: rgba(0, 0, 0, 0.12);
            --muscle-stroke: rgba(0, 0, 0, 0.18);
        }

        /* Day Specific Accents - Studio 2026: Ultra-vibrant oklch() */
        .accent-push-a {
            --accent-color: oklch(70% 0.22 25);
            --accent-glow: oklch(70% 0.22 25 / 0.35);
            --accent-gradient: linear-gradient(135deg, oklch(70% 0.22 25) 0%, oklch(62% 0.24 20) 100%);
        }

        .accent-pull-a {
            --accent-color: oklch(70% 0.15 300);
            --accent-glow: oklch(70% 0.15 300 / 0.35);
            --accent-gradient: linear-gradient(135deg, oklch(70% 0.15 300) 0%, oklch(60% 0.18 290) 100%);
        }

        .accent-push-b {
            --accent-color: oklch(78% 0.14 175);
            --accent-glow: oklch(78% 0.14 175 / 0.35);
            --accent-gradient: linear-gradient(135deg, oklch(78% 0.14 175) 0%, oklch(70% 0.16 170) 100%);
        }

        .accent-pull-b {
            --accent-color: oklch(72% 0.18 230);
            --accent-glow: oklch(72% 0.18 230 / 0.35);
            --accent-gradient: linear-gradient(135deg, oklch(72% 0.18 230) 0%, oklch(75% 0.2 200) 100%);
        }

        /* GLOBAL RESET */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            background-image: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-primary);
            font-family: var(--font-main);
            height: 100dvh;
            overflow: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* Animated background glow */
        .liquid-bg {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, var(--accent-glow), transparent 50%);
            opacity: 0.5;
            pointer-events: none;
            z-index: -1;
            transition: background 0.8s ease;
            animation: liquidFloat 20s ease-in-out infinite;
        }

        /* Studio 2026: Scroll-driven parallax on liquid background */
        @supports (animation-timeline: scroll()) {
            .liquid-bg {
                animation:
                    liquidFloat 20s ease-in-out infinite,
                    liquidParallax linear both;
                animation-timeline: auto, scroll(root);
            }

            @keyframes liquidParallax {
                from {
                    transform: translateY(0%) scale(1);
                    opacity: 0.5;
                }

                to {
                    transform: translateY(-10%) scale(1.05);
                    opacity: 0.7;
                }
            }
        }

        @keyframes liquidFloat {

            0%,
            100% {
                transform: translate(0, 0) rotate(0deg);
            }

            33% {
                transform: translate(2%, 2%) rotate(1deg);
            }

            66% {
                transform: translate(-1%, 1%) rotate(-0.5deg);
            }
        }

        #app-container {
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
            padding-bottom: calc(var(--nav-height) + var(--space-md));
            position: relative;
            z-index: 1;
        }

        /* ========================================
           HEADER
           ======================================== */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: var(--space-lg) var(--space-md) var(--space-sm);
            background: transparent;
            transition: all var(--duration-normal) var(--ease-fluid);
            /* Bug fix: Prevent layout thrashing during scroll */
            will-change: padding, backdrop-filter;
        }

        header.scrolled {
            padding: var(--space-sm) var(--space-md);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border-bottom: 1px solid var(--glass-border);
            background: var(--glass-surface);
            display: block;
            /* Reset to block for stable text alignment */
            position: sticky;
        }

        /* Position toggle absolutely to not affect title alignment */
        header.scrolled .header-top {
            margin-bottom: 0;
            width: auto;
            position: absolute;
            top: 50%;
            right: var(--space-md);
            transform: translateY(-50%);
            z-index: 10;
        }

        header.scrolled .app-label {
            display: none;
        }

        header.scrolled h1.day-title {
            font-size: var(--text-2xl);
            letter-spacing: -0.5px;
            margin: 0;
            line-height: 1.5;
        }

        header.scrolled p.day-subtitle {
            display: none;
        }

        header.scrolled .theme-toggle {
            width: 36px;
            height: 36px;
        }

        header.scrolled .theme-toggle svg {
            width: 16px;
            height: 16px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xs);
        }

        .app-label {
            font-size: var(--text-xs);
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            transition: opacity var(--duration-fast) ease, height var(--duration-fast) ease, margin var(--duration-fast) ease;
        }

        .theme-toggle {
            background: var(--glass-surface-strong);
            border: 1px solid var(--glass-border);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px oklch(0% 0 0 / 0.1);
            transition: transform var(--duration-micro) var(--ease-bounce), box-shadow var(--duration-micro) ease;
        }

        .theme-toggle:hover {
            box-shadow: 0 6px 16px oklch(0% 0 0 / 0.15);
        }

        .theme-toggle:active {
            transform: scale(0.92);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: var(--text-primary);
            transition: transform 0.5s var(--ease-bounce);
        }

        h1.day-title {
            font-size: var(--text-hero);
            font-weight: 900;
            letter-spacing: -1.5px;
            line-height: 1.05;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: font-size var(--duration-normal) var(--ease-fluid),
                letter-spacing var(--duration-normal) var(--ease-fluid),
                font-weight var(--duration-normal) var(--ease-fluid);
            /* Studio 2026: Kinetic variable font - support weight axis */
            font-variation-settings: 'wght' 900;
        }

        /* Kinetic font: weight shifts when scrolled */
        header.scrolled h1.day-title {
            font-variation-settings: 'wght' 700;
        }

        p.day-subtitle {
            font-size: var(--text-base);
            color: var(--text-secondary);
            margin-top: 6px;
            font-weight: 500;
            transition: opacity var(--duration-fast) ease, height var(--duration-fast) ease, margin var(--duration-fast) ease;
        }

        /* ========================================
           DAY THEME HERO
           ======================================== */
        .day-theme-hero {
            margin: 0 var(--space-md) var(--space-md);
            padding: var(--space-sm) var(--space-md);
            background: var(--glass-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            /* Studio 2026: Flex layout for muscle map integration */
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .day-theme-hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--accent-glow), transparent 70%);
            opacity: 0.3;
            pointer-events: none;
        }

        .hero-text {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .theme-label {
            font-size: var(--text-xs);
            font-weight: 700;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--accent-color);
            margin-bottom: 4px;
            display: block;
        }

        .theme-text {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* ========================================
           MUSCLE MAP VISUALIZATION
           Studio 2026: Anatomical Muscle Chart
           ======================================== */
        .muscle-map {
            display: flex;
            gap: 16px;
            width: auto;
            height: 160px;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }

        .muscle-map .view-container {
            width: 70px;
            height: 100%;
            position: relative;
        }

        .muscle-map svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .muscle-map .view-label {
            font-size: 10px;
            font-weight: 700;
            fill: var(--text-tertiary);
            text-anchor: middle;
            opacity: 0.7;
            letter-spacing: 1px;
        }

        .muscle-map .muscle {
            fill: var(--muscle-fill);
            stroke: var(--muscle-stroke);
            stroke-width: 2px;
            stroke-linejoin: round;
            transition: all 0.3s ease;
        }

        .muscle-map .muscle-static {
            fill: var(--muscle-fill);
            stroke: var(--muscle-stroke);
            stroke-width: 2px;
            stroke-linejoin: round;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .muscle-map .muscle.targeted {
            fill: oklch(45% 0.12 25 / 0.5);
            stroke: oklch(55% 0.15 25 / 0.6);
            stroke-width: 0.4;
        }

        .muscle-map .muscle.completed {
            fill: oklch(55% 0.2 25 / 0.9);
            stroke: oklch(70% 0.18 30 / 0.8);
            stroke-width: 0.5;
            filter: drop-shadow(0 0 4px oklch(60% 0.25 25 / 0.6));
        }

        /* Pulse animation for newly completed muscle */
        @keyframes muscleComplete {
            0% {
                filter: drop-shadow(0 0 4px oklch(60% 0.25 25 / 0.6));
            }

            50% {
                filter: drop-shadow(0 0 12px oklch(65% 0.3 25 / 0.9)) brightness(1.2);
            }

            100% {
                filter: drop-shadow(0 0 4px oklch(60% 0.25 25 / 0.6));
            }
        }

        .muscle-map .muscle.just-completed {
            animation: muscleComplete 0.6s var(--ease-bounce);
        }

        /* ========================================
           PROGRESS BAR
           ======================================== */
        .day-progress {
            height: 4px;
            background: var(--glass-surface);
            border-radius: 2px;
            overflow: hidden;
            margin: 0 var(--space-md) var(--space-sm);
        }

        .day-progress-fill {
            height: 100%;
            background: var(--accent-gradient);
            border-radius: 2px;
            width: 0%;
            transition: width 0.5s var(--ease-spring), filter 0.3s ease;
            box-shadow: 0 0 12px var(--accent-glow);
            position: relative;
            overflow: hidden;
        }

        /* Studio 2026: Milestone celebration burst */
        .day-progress-fill.milestone {
            animation: milestoneBurst 0.6s var(--ease-bounce);
        }

        .day-progress-fill.complete {
            background: linear-gradient(135deg, oklch(75% 0.18 145) 0%, oklch(80% 0.16 160) 100%);
            animation: milestoneBurst 0.8s var(--ease-bounce);
        }

        @keyframes milestoneBurst {

            0%,
            100% {
                filter: brightness(1);
                transform: scaleY(1);
            }

            30% {
                filter: brightness(1.4);
                transform: scaleY(1.5);
            }

            60% {
                filter: brightness(1.2);
                transform: scaleY(1.2);
            }
        }

        /* Studio 2026: Progress shimmer animation */
        .day-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent 0%,
                    oklch(100% 0 0 / 0.4) 50%,
                    transparent 100%);
            animation: progressShimmer 2s ease-in-out infinite;
        }

        @keyframes progressShimmer {
            0% {
                left: -100%;
            }

            100% {
                left: 200%;
            }
        }

        /* ========================================
           EXERCISE CARDS
           ======================================== */
        .card-list {
            padding: 0 var(--space-md);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .card {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-md);
            backdrop-filter: blur(24px) saturate(120%);
            -webkit-backdrop-filter: blur(24px) saturate(120%);
            /* Studio 2026: Soft Spatial UI - multi-layered depth */
            box-shadow:
                0 1px 2px oklch(0% 0 0 / 0.08),
                0 4px 8px oklch(0% 0 0 / 0.1),
                0 12px 24px oklch(0% 0 0 / 0.12),
                inset 0 1px 0 oklch(100% 0 0 / 0.08);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: transform var(--duration-micro) var(--ease-spring),
                box-shadow var(--duration-fast) ease,
                background var(--duration-micro) ease;
            animation: cardEnter 0.4s var(--ease-spring) backwards;
        }

        .card:hover {
            box-shadow:
                0 2px 4px oklch(0% 0 0 / 0.1),
                0 8px 16px oklch(0% 0 0 / 0.12),
                0 20px 40px oklch(0% 0 0 / 0.15),
                inset 0 1px 0 oklch(100% 0 0 / 0.1);
        }

        .card.expanded {
            box-shadow:
                0 2px 4px oklch(0% 0 0 / 0.1),
                0 8px 16px oklch(0% 0 0 / 0.12),
                0 24px 48px oklch(0% 0 0 / 0.18),
                0 0 40px var(--accent-glow),
                inset 0 1px 0 oklch(100% 0 0 / 0.12);
        }

        /* Studio 2026: Scroll-Driven Card Entrance Animations */
        @supports (animation-timeline: view()) {
            .card {
                animation: scrollReveal linear both;
                animation-timeline: view();
                animation-range: entry 0% entry 40%;
            }

            @keyframes scrollReveal {
                from {
                    opacity: 0;
                    transform: translateY(30px) scale(0.96);
                    filter: blur(4px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                    filter: blur(0);
                }
            }

            /* Staggered delays for visual richness */
            .card:nth-child(2) {
                animation-range: entry 5% entry 45%;
            }

            .card:nth-child(3) {
                animation-range: entry 10% entry 50%;
            }

            .card:nth-child(4) {
                animation-range: entry 15% entry 55%;
            }

            .card:nth-child(5) {
                animation-range: entry 20% entry 60%;
            }
        }

        /* Fallback for browsers without scroll-driven animation support */
        @supports not (animation-timeline: view()) {
            .card {
                animation: cardEnterFallback 0.4s var(--ease-spring) backwards;
            }

            .card:nth-child(1) {
                animation-delay: 0.05s;
            }

            .card:nth-child(2) {
                animation-delay: 0.1s;
            }

            .card:nth-child(3) {
                animation-delay: 0.15s;
            }

            .card:nth-child(4) {
                animation-delay: 0.2s;
            }

            .card:nth-child(5) {
                animation-delay: 0.25s;
            }

            @keyframes cardEnterFallback {
                from {
                    opacity: 0;
                    transform: translateY(20px) scale(0.95);
                }
            }
        }

        .card:active {
            transform: scale(0.98);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--glass-highlight), transparent);
        }

        /* Card Header */
        .card-header {
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            align-items: center;
            gap: var(--space-sm);
        }

        /* Studio 2026: Chevron expansion affordance */
        .expand-chevron {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.4;
            transition: transform var(--duration-fast) var(--ease-spring),
                opacity var(--duration-fast) ease;
        }

        .expand-chevron::before {
            content: '';
            width: 8px;
            height: 8px;
            border-right: 2px solid var(--text-secondary);
            border-bottom: 2px solid var(--text-secondary);
            transform: rotate(45deg);
            transition: transform var(--duration-fast) var(--ease-spring);
        }

        .card:hover .expand-chevron {
            opacity: 0.7;
        }

        .card.expanded .expand-chevron {
            opacity: 0.6;
        }

        .card.expanded .expand-chevron::before {
            transform: rotate(-135deg);
        }

        .exercise-order {
            width: 32px;
            height: 32px;
            background: var(--accent-gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: #fff;
            box-shadow: 0 4px 12px var(--accent-glow);
            flex-shrink: 0;
            /* Studio 2026: Accent glow pulse */
            animation: accentPulse 2.5s ease-in-out infinite;
        }

        @keyframes accentPulse {

            0%,
            100% {
                box-shadow: 0 4px 12px var(--accent-glow);
            }

            50% {
                box-shadow: 0 4px 20px var(--accent-glow), 0 0 30px var(--accent-glow);
            }
        }

        .card.completed .exercise-order {
            animation: none;
            opacity: 0.5;
        }

        .exercise-info h3 {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            transition: all var(--duration-fast) ease;
        }

        .meta-row {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .meta-pill {
            font-size: var(--text-sm);
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 8px;
            background: oklch(100% 0 0 / 0.06);
            color: var(--text-secondary);
        }

        .meta-pill.accent {
            background: var(--accent-glow);
            color: var(--accent-color);
        }

        .rir-chip {
            font-size: var(--text-xs);
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .rir-chip.intense {
            background: oklch(65% 0.22 25 / 0.15);
            color: oklch(70% 0.2 25);
        }

        .rir-chip.controlled {
            background: oklch(75% 0.15 70 / 0.15);
            color: oklch(80% 0.15 70);
        }

        .rest-badge {
            font-size: var(--text-xs);
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 6px;
            background: oklch(100% 0 0 / 0.06);
            color: var(--text-tertiary);
            cursor: pointer;
            transition: background var(--duration-micro) ease, color var(--duration-micro) ease;
        }

        .rest-badge:hover {
            background: var(--accent-glow);
            color: var(--accent-color);
        }

        .checkbox-wrapper {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            border: 2px solid var(--glass-border);
            background: oklch(0% 0 0 / 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--duration-micro) var(--ease-bounce);
            flex-shrink: 0;
        }

        .card.completed .checkbox-wrapper {
            background: var(--accent-gradient);
            border-color: transparent;
            box-shadow: 0 4px 12px var(--accent-glow);
        }

        /* Studio 2026: Visual haptic feedback on completion */
        @keyframes completePulse {
            0% {
                box-shadow: var(--glass-shadow);
                border-color: var(--glass-border);
            }

            40% {
                box-shadow: var(--glass-shadow-elevated), 0 0 25px var(--accent-glow);
                border-color: var(--accent-color);
            }

            100% {
                box-shadow: var(--glass-shadow);
                border-color: var(--glass-border);
            }
        }

        .card.just-completed {
            animation: completePulse 0.5s var(--ease-fluid);
            /* Prevent cardEnter animation from replaying */
            opacity: 1 !important;
            transform: none !important;
        }

        .card.completed .exercise-info h3 {
            text-decoration: line-through;
            opacity: 0.4;
        }

        .card.completed .meta-row {
            opacity: 0.4;
        }

        .check-icon {
            width: 16px;
            height: 16px;
            fill: #fff;
            opacity: 0;
            transform: scale(0.5);
            transition: all var(--duration-micro) var(--ease-bounce);
        }

        .card.completed .check-icon {
            opacity: 1;
            transform: scale(1);
        }

        /* EXPANDED DETAILS */
        .details-wrapper {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s var(--ease-fluid);
        }

        .card.expanded .details-wrapper {
            grid-template-rows: 1fr;
            margin-top: var(--space-sm);
        }

        .details-inner {
            overflow: hidden;
            opacity: 0;
            transform: translateY(8px);
            transition: opacity 0.3s ease 0.1s, transform 0.3s ease 0.1s;
        }

        .card.expanded .details-inner {
            opacity: 1;
            transform: translateY(0);
        }

        .glass-inner-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            margin-top: var(--space-xs);
            border: 1px solid var(--glass-border);
        }

        .label-pill {
            font-size: var(--text-xs);
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--accent-color);
            margin-bottom: 8px;
            display: block;
        }

        .label-pill.warning {
            color: oklch(80% 0.15 60);
        }

        .label-pill.pro {
            color: oklch(78% 0.14 175);
        }

        .label-pill.accent {
            color: var(--accent-color);
        }

        .tip-text {
            font-size: var(--text-sm);
            line-height: 1.55;
            color: var(--text-secondary);
        }

        /* Action Footer */
        .actions-footer {
            padding: 12px 16px 24px;
            display: flex;
            justify-content: flex-end;
            /* Right aligned */
            width: 100%;
        }

        .action-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.05);
            /* Very subtle */
            color: var(--text-tertiary);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.4;
            /* Almost invisible */
        }

        .action-btn:hover {
            opacity: 1;
            border-color: rgba(255, 255, 255, 0.2);
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.02);
        }

        .action-btn.complete {
            /* No special style, keep it uniform "ghost" style */
        }

        /* Technique Steps */
        .technique-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .technique-list li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: var(--text-sm);
            line-height: 1.5;
            color: var(--text-secondary);
        }

        .step-num {
            min-width: 20px;
            height: 20px;
            background: var(--accent-gradient);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xs);
            font-weight: 700;
            color: #fff;
            flex-shrink: 0;
        }

        /* Mistakes List */
        .mistakes-panel {
            background: oklch(80% 0.15 60 / 0.05);
            border-color: oklch(80% 0.15 60 / 0.15);
        }

        .mistakes-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .mistakes-list li {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: var(--text-sm);
            line-height: 1.5;
            color: var(--text-secondary);
        }

        .mistake-icon {
            color: oklch(70% 0.22 25);
            font-weight: 700;
            flex-shrink: 0;
        }

        /* Visualization Panel */
        .viz-panel {
            background: linear-gradient(135deg, rgba(var(--accent-color), 0.05), transparent);
            position: relative;
            overflow: hidden;
        }

        .viz-panel::before {
            content: '"';
            position: absolute;
            top: 8px;
            right: 12px;
            font-size: 48px;
            font-weight: 900;
            color: var(--accent-glow);
            opacity: 0.3;
            line-height: 1;
        }

        /* Pro Tip Panel */
        .pro-panel {
            background: oklch(78% 0.14 175 / 0.05);
            border-color: oklch(78% 0.14 175 / 0.15);
        }

        /* ========================================
           NAVIGATION DOCK
           ======================================== */
        .nav-dock-container {
            position: fixed;
            bottom: var(--space-md);
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 550px;
            /* Increased to accommodate button */
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            pointer-events: none;
            /* Let clicks pass through gaps */
            padding: 0 16px;
            /* Horizontal safety padding */
        }

        .nav-dock {
            height: 72px;
            border-radius: var(--radius-xl);
            background: var(--nav-glass);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid oklch(100% 0 0 / 0.08);
            /* Studio 2026: Floating island spatial depth */
            box-shadow:
                0 2px 4px oklch(0% 0 0 / 0.05),
                0 8px 16px oklch(0% 0 0 / 0.1),
                0 20px 40px oklch(0% 0 0 / 0.12),
                0 40px 80px oklch(0% 0 0 / 0.08),
                inset 0 1px 0 oklch(100% 0 0 / 0.12),
                inset 0 0 20px oklch(100% 0 0 / 0.02);
            display: flex;
            align-items: center;
            /* justify-content: space-around; REMOVED to allow flex-grow to work evenly */
            padding: 4px;
            /* Reduced padding to allow items to fill space */
            pointer-events: auto;
            flex-grow: 1;
        }

        .nav-item {
            position: relative;
            padding: 12px 0;
            /* Horizontal padding removed, width handled by flex */
            cursor: pointer;
            text-align: center;
            border-radius: 99px;
            /* Fix: Match pill shape perfectly */
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            flex: 1 1 0px;
            /* Fix: Force equal width regardless of content */
        }

        /* Fix: Match curvature for end items */
        .nav-item:first-child {
            border-top-left-radius: 99px;
            border-bottom-left-radius: 99px;
        }

        .nav-item:last-child {
            border-top-right-radius: 99px;
            border-bottom-right-radius: 99px;
        }

        .nav-day {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--nav-text);
            opacity: 0.4;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: opacity var(--duration-micro);
        }

        .nav-text {
            font-size: var(--text-sm);
            font-weight: 700;
            color: var(--nav-text);
            opacity: 0.5;
            transition: opacity var(--duration-micro);
        }

        .nav-item.active {
            background: var(--nav-active-pill);
        }

        .nav-item.active .nav-text,
        .nav-item.active .nav-day {
            opacity: 1;
        }

        /* ========================================
           REST TIMER
           ======================================== */
        .timer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .timer-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .timer-card {
            background: var(--glass-surface-strong);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            text-align: center;
            min-width: 280px;
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            transform: scale(0.9);
            transition: transform 0.3s var(--ease-bounce);
        }

        .timer-overlay.active .timer-card {
            transform: scale(1);
        }

        .timer-label {
            font-size: var(--text-sm);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-tertiary);
            margin-bottom: var(--space-xs);
        }

        .timer-display {
            font-size: clamp(3rem, 2.5rem + 3vw, 4.5rem);
            font-weight: 800;
            color: var(--accent-color);
            font-variant-numeric: tabular-nums;
            line-height: 1;
            margin-bottom: var(--space-md);
        }

        .timer-btn {
            background: var(--accent-gradient);
            border: none;
            color: #fff;
            font-size: var(--text-base);
            font-weight: 700;
            padding: 14px 32px;
            border-radius: 16px;
            cursor: pointer;
            box-shadow: 0 8px 20px var(--accent-glow);
            transition: transform var(--duration-micro) ease;
        }

        .timer-btn:active {
            transform: scale(0.95);
        }

        /* Spacer - minimal to just clear nav */
        .spacer {
            height: 16px;
        }

        /* ========================================
           SKELETON LOADING STATES
           Studio 2026: Skeleton-first, never spinners
           ======================================== */
        @keyframes skeletonPulse {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 0.7;
            }
        }

        .skeleton {
            background: linear-gradient(90deg,
                    var(--glass-surface) 25%,
                    var(--glass-surface-strong) 50%,
                    var(--glass-surface) 75%);
            background-size: 200% 100%;
            animation: skeletonPulse 1.5s ease-in-out infinite;
            border-radius: var(--radius-sm);
        }

        .skeleton-card {
            height: 80px;
            margin-bottom: var(--space-sm);
            border-radius: var(--radius-xl);
        }

        .skeleton-text {
            height: 1em;
            width: 60%;
            margin-bottom: 0.5em;
        }

        .skeleton-text.short {
            width: 40%;
        }

        .card-list.loading .card {
            display: none;
        }

        .card-list.loading::before,
        .card-list.loading::after {
            content: '';
            display: block;
            background: var(--glass-surface);
            border-radius: var(--radius-xl);
            animation: skeletonPulse 1.5s ease-in-out infinite;
        }

        .card-list.loading::before {
            height: 100px;
            margin-bottom: var(--space-sm);
        }

        .card-list.loading::after {
            height: 100px;
            animation-delay: 0.2s;
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* AI Chatbot - Glassmorphism */
        #ai-trigger-btn {
            /* Positioning is now handled by parent flex container */
            position: relative;
            flex-shrink: 0;
            pointer-events: auto;
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: var(--glass-surface-strong);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--glass-shadow-elevated);
            z-index: 200;
            cursor: pointer;
            transition: transform 0.3s var(--ease-bounce), box-shadow 0.3s ease;
        }

        #ai-trigger-btn svg {
            width: 28px;
            height: 28px;
            fill: var(--accent-color, #7038FF);
            transition: transform 0.5s ease;
        }

        #ai-trigger-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--accent-glow);
        }

        #ai-trigger-btn:active {
            transform: scale(0.95);
        }

        /* Mobile positioning */
        @media (max-width: 768px) {
            #ai-trigger-btn {
                /* Static size maintained */
                width: 72px;
                height: 72px;
            }

            /* Removed override for nav-dock-container padding */
        }

        /* Chat Overlay */
        #chat-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 2000;
            /* Fix: Higher than nav-dock (1000) */
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #chat-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        /* Chat Window */
        #chat-window {
            width: 90%;
            max-width: 400px;
            /* Default: Modal for Desktop */
            height: 600px;
            max-height: 80vh;
            background: var(--glass-surface-elevated);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--glass-shadow-elevated);
            display: flex;
            flex-direction: column;
            overflow: hidden;

            /* Animation Origin injected by JS */
            transform-origin: var(--origin-x, 50%) var(--origin-y, 100%);
            transform: scale(0.1);
            /* Start very small */
            opacity: 0;
            transition:
                transform 0.5s cubic-bezier(0.19, 1, 0.22, 1),
                opacity 0.3s ease;
        }

        /* Mobile Optimization: Bottom Sheet Style */
        @media (max-width: 480px) {
            #chat-overlay {
                align-items: flex-end;
                /* Align to bottom */
                padding-bottom: 0;
                /* Flush with bottom */
            }

            #chat-window {
                width: 100%;
                max-width: 100%;
                /* Taller on mobile to fill space */
                height: 85dvh;
                max-height: 85dvh;
                border-radius: 24px 24px 0 0;
                /* Rounded top only */
                border-bottom: none;
                margin-bottom: 0;
            }

            /* Ensure the morph origin starts from bottom center roughly */
            #chat-window {
                transform-origin: 50% 100% !important;
            }
        }

        #chat-overlay.active #chat-window {
            transform: scale(1);
            opacity: 1;
        }

        /* Hide Nav Dock when Chat is open */
        body.chat-open .nav-dock-container {
            opacity: 0;
            pointer-events: none;
            transform: translateX(-50%) translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* Chat Header */
        .chat-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--glass-surface-strong);
        }

        .chat-title {
            font-weight: 700;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bot-avatar {
            width: 24px;
            height: 24px;
            background: var(--accent-gradient);
            border-radius: 50%;
        }

        .icon-btn {
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .icon-btn:hover {
            opacity: 1;
        }

        /* Chat Body */
        #chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-message {
            padding: 10px 16px;
            border-radius: 16px;
            max-width: 85%;
            font-size: 14px;
            line-height: 1.5;
            animation: msgEnter 0.3s ease forwards;
        }

        @keyframes msgEnter {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message.user {
            align-self: flex-end;
            background: var(--accent-gradient);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-message.ai {
            align-self: flex-start;
            background: var(--glass-surface-strong);
            border: 1px solid var(--glass-border);
            border-bottom-left-radius: 4px;
        }

        .chat-message.system {
            align-self: center;
            font-size: 11px;
            color: var(--text-tertiary);
            background: transparent;
            border: none;
            text-align: center;
        }

        /* Input Area */
        .chat-input-area {
            padding: 16px;
            border-top: 1px solid var(--glass-border);
            display: flex;
            gap: 8px;
        }

        #chat-input {
            flex: 1;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 10px 16px;
            color: var(--text-primary);
            outline: none;
        }

        #chat-send {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-color);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
        }

        /* Settings Panel */
        #api-settings {
            height: 0;
            overflow: hidden;
            transition: height 0.3s ease;
            background: rgba(0, 0, 0, 0.2);
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #api-settings.show {
            height: 60px;
            padding: 10px 20px;
        }
    </style>
</head>

<body data-theme="dark" class="accent-pull-b">

    <div class="liquid-bg" id="liquid-bg"></div>

    <!-- Rest Timer Overlay -->
    <div class="timer-overlay" id="timer-overlay">
        <div class="timer-card">
            <span class="timer-label">Rest Time</span>
            <div class="timer-display" id="timer-display">2:00</div>
            <button class="timer-btn" id="timer-btn">Skip</button>
        </div>
    </div>

    <!-- Main Scroll Container -->
    <div id="app-container">
        <header id="header" class="scrolled">
            <div class="header-top">
                <span class="app-label">Hypertrophy</span>
                <button class="theme-toggle" id="theme-toggle">
                    <svg id="theme-icon" viewBox="0 0 24 24">
                        <path
                            d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z">
                        </path>
                    </svg>
                </button>
            </div>
            <h1 class="day-title" id="day-title">Pull B</h1>
            <p class="day-subtitle" id="day-subtitle">Hamstring Isolation + Upper Back Bias</p>
        </header>

        <!-- Day Theme Hero -->
        <div class="day-theme-hero">
            <div class="hero-text">
                <span class="theme-label" id="theme-label">Today's Focus</span>
                <p class="theme-text" id="theme-text">Shortened Position Hamstrings + Horizontal Pulling.</p>
            </div>
            <!-- Muscle Map Visualization: Anatomical Chart -->
            <!-- Muscle Map Visualization: Dual View (Front/Back) -->
            <div class="muscle-map" id="muscle-map">
                <!-- FRONT VIEW -->
                <div class="view-container">
                    <svg viewBox="0 0 100 230" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="glow-front" x="-20%" y="-20%" width="140%" height="140%">
                                <feGaussianBlur stdDeviation="2" result="blur" />
                                <feComposite in="SourceGraphic" in2="blur" operator="over" />
                            </filter>
                            <filter id="silhouette-front" x="-20%" y="-20%" width="140%" height="140%">
                                <feMorphology operator="dilate" radius="2" in="SourceAlpha" result="thick" />
                                <feFlood flood-color="rgba(255, 255, 255, 0.1)" result="color" />
                                <feComposite in="color" in2="thick" operator="in" result="coloredThick" />
                                <feComposite in="SourceGraphic" in2="coloredThick" operator="over" />
                            </filter>
                        </defs>

                        <g filter="url(#silhouette-front)">
                            <!-- HEAD & NECK (Static Front) -->
                            <path class="muscle-static"
                                d="M50 5 C44 5 40 10 40 18 C40 26 44 32 50 32 C56 32 60 26 60 18 C60 10 56 5 50 5 Z" />
                            <path class="muscle-static"
                                d="M42 28 L38 36 L40 38 L44 38 L50 40 L56 38 L60 38 L62 36 L58 28 Z" />

                            <!-- CHEST -->
                            <path id="muscle-chest-l" class="muscle"
                                d="M50 40 L50 58 C42 56 36 52 36 44 C36 40 42 38 50 40 Z" />
                            <path id="muscle-chest-r" class="muscle"
                                d="M50 40 L50 58 C58 56 64 52 64 44 C64 40 58 38 50 40 Z" />

                            <!-- SHOULDERS (Front) -->
                            <path id="muscle-shoulders-front-l" class="muscle"
                                d="M36 38 L24 42 C22 46 22 52 24 56 L32 54 C34 48 36 44 36 38 Z" />
                            <path id="muscle-shoulders-front-r" class="muscle"
                                d="M64 38 L76 42 C78 46 78 52 76 56 L68 54 C66 48 64 44 64 38 Z" />

                            <!-- ARMS (Front) -->
                            <path id="muscle-biceps-l" class="muscle" d="M24 57 L32 55 L32 68 C30 70 26 70 24 68 Z" />
                            <path id="muscle-biceps-r" class="muscle" d="M76 57 L68 55 L68 68 C70 70 74 70 76 68 Z" />
                            <path id="muscle-forearms-front-l" class="muscle"
                                d="M24 69 L32 69 L30 86 L22 86 L22 72 Z" />
                            <path id="muscle-forearms-front-r" class="muscle"
                                d="M76 69 L68 69 L70 86 L78 86 L78 72 Z" />

                            <!-- CORE -->
                            <path id="muscle-core-1" class="muscle" d="M42 58 L58 58 L56 66 L44 66 Z" />
                            <path id="muscle-core-2" class="muscle" d="M44 67 L56 67 L56 74 L44 74 Z" />
                            <path id="muscle-core-3" class="muscle" d="M45 75 L55 75 L54 84 L46 84 Z" />
                            <path id="muscle-obliques-l" class="muscle" d="M41 60 L34 52 L34 78 L44 82 Z" />
                            <path id="muscle-obliques-r" class="muscle" d="M59 60 L66 52 L66 78 L56 82 Z" />

                            <!-- Visible Lats (Front) -->
                            <path id="muscle-lats-front-l" class="muscle"
                                d="M34 54 C30 60 30 70 34 78 L40 70 L40 54 Z" />
                            <path id="muscle-lats-front-r" class="muscle"
                                d="M66 54 C70 60 70 70 66 78 L60 70 L60 54 Z" />

                            <!-- LEGS (Front) -->
                            <path id="muscle-quads-l" class="muscle" d="M48 86 L36 86 C32 98 32 120 36 140 L48 136 Z" />
                            <path id="muscle-quads-r" class="muscle" d="M52 86 L64 86 C68 98 68 120 64 140 L52 136 Z" />
                            <path id="muscle-quads-inner-l" class="muscle" d="M48 88 L50 125 L48 136 Z" />
                            <path id="muscle-quads-inner-r" class="muscle" d="M52 88 L50 125 L52 136 Z" />

                            <path id="muscle-calves-front-l" class="muscle"
                                d="M36 144 C34 150 34 165 36 180 L44 178 C46 165 44 150 42 144 Z" />
                            <path id="muscle-calves-front-r" class="muscle"
                                d="M64 144 C66 150 66 165 64 180 L56 178 C54 165 56 150 58 144 Z" />

                            <!-- HANDS (Static) -->
                            <path class="muscle-static" d="M22 88 L30 88 L32 96 L28 100 L20 96 Z" />
                            <path class="muscle-static" d="M78 88 L70 88 L68 96 L72 100 L80 96 Z" />

                            <!-- FEET (Static) -->
                            <path class="muscle-static" d="M36 182 L44 180 L46 190 L34 190 Z" />
                            <path class="muscle-static" d="M64 182 L56 180 L54 190 L66 190 Z" />
                        </g>

                        <text class="view-label" x="50" y="210">FRONT</text>
                    </svg>
                </div>

                <!-- BACK VIEW -->
                <div class="view-container">
                    <svg viewBox="0 0 100 230" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="glow-back" x="-20%" y="-20%" width="140%" height="140%">
                                <feGaussianBlur stdDeviation="2" result="blur" />
                                <feComposite in="SourceGraphic" in2="blur" operator="over" />
                            </filter>
                            <filter id="silhouette-back" x="-20%" y="-20%" width="140%" height="140%">
                                <feMorphology operator="dilate" radius="2" in="SourceAlpha" result="thick" />
                                <feFlood flood-color="rgba(255, 255, 255, 0.1)" result="color" />
                                <feComposite in="color" in2="thick" operator="in" result="coloredThick" />
                                <feComposite in="SourceGraphic" in2="coloredThick" operator="over" />
                            </filter>
                        </defs>

                        <g filter="url(#silhouette-back)">
                            <!-- HEAD (Static Back) -->
                            <path class="muscle-static"
                                d="M50 5 C44 5 40 10 40 18 C40 26 44 32 50 32 C56 32 60 26 60 18 C60 10 56 5 50 5 Z" />

                            <!-- TRAPS & NECK -->
                            <path id="muscle-traps-upper" class="muscle"
                                d="M42 28 L32 35 L36 40 L50 48 L64 40 L68 35 L58 28 Z" />
                            <path id="muscle-traps-mid" class="muscle"
                                d="M50 49 L42 42 L46 65 L50 75 L54 65 L58 42 Z" />

                            <!-- SHOULDERS (Rear) -->
                            <path id="muscle-shoulders-back-l" class="muscle"
                                d="M36 40 L24 42 C22 46 22 52 24 56 L32 54 Z" />
                            <path id="muscle-shoulders-back-r" class="muscle"
                                d="M64 40 L76 42 C78 46 78 52 76 56 L68 54 Z" />

                            <!-- LATS (Back) -->
                            <path id="muscle-lats-l" class="muscle"
                                d="M46 66 L40 44 L32 55 C28 62 30 75 36 82 L42 84 Z" />
                            <path id="muscle-lats-r" class="muscle"
                                d="M54 66 L60 44 L68 55 C72 62 70 75 64 82 L58 84 Z" />

                            <!-- LOWER BACK -->
                            <path id="muscle-lower-back" class="muscle" d="M44 86 L56 86 L54 94 L46 94 Z" />

                            <!-- ARMS (Back) -->
                            <path id="muscle-triceps-l" class="muscle" d="M24 57 L32 55 L32 68 C30 70 26 70 24 68 Z" />
                            <path id="muscle-triceps-r" class="muscle" d="M76 57 L68 55 L68 68 C70 70 74 70 76 68 Z" />
                            <path id="muscle-forearms-back-l" class="muscle" d="M24 69 L32 69 L30 86 L22 86 L22 72 Z" />
                            <path id="muscle-forearms-back-r" class="muscle" d="M76 69 L68 69 L70 86 L78 86 L78 72 Z" />

                            <!-- GLUTES -->
                            <path id="muscle-glutes-l" class="muscle"
                                d="M50 90 L36 84 C32 88 30 100 36 108 L50 110 Z" />
                            <path id="muscle-glutes-r" class="muscle"
                                d="M50 90 L64 84 C68 88 70 100 64 108 L50 110 Z" />

                            <!-- HAMSTRINGS -->
                            <path id="muscle-hamstrings-l" class="muscle"
                                d="M36 110 C34 118 34 130 38 140 L48 136 L48 112 Z" />
                            <path id="muscle-hamstrings-r" class="muscle"
                                d="M64 110 C66 118 66 130 62 140 L52 136 L52 112 Z" />

                            <!-- CALVES (Back) -->
                            <path id="muscle-calves-back-l" class="muscle"
                                d="M38 144 C34 148 34 160 38 175 L46 170 C48 160 48 148 44 144 Z" />
                            <path id="muscle-calves-back-r" class="muscle"
                                d="M62 144 C66 148 66 160 62 175 L54 170 C52 160 52 148 56 144 Z" />

                            <!-- HANDS (Static Back) -->
                            <path class="muscle-static" d="M22 88 L30 88 L32 98 L20 98 Z" />
                            <path class="muscle-static" d="M78 88 L70 88 L68 98 L80 98 Z" />

                            <!-- FEET (Static Back) -->
                            <path class="muscle-static" d="M38 178 L46 172 L46 188 L38 188 Z" />
                            <path class="muscle-static" d="M62 178 L54 172 L54 188 L62 188 Z" />
                        </g>

                        <text class="view-label" x="50" y="210">BACK</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="day-progress">
            <div class="day-progress-fill" id="progress-fill" style="width: 0%;"></div>
        </div>

        <!-- Exercise Cards -->
        <div class="card-list" id="card-list"
            style="transition: opacity 0.25s, transform 0.25s; opacity: 1; transform: translateY(0px);">
            <article class="card expanded" id="pull-b-0" onclick="App.toggleCard(&#39;pull-b-0&#39;)">
                <div class="card-header">
                    <div class="exercise-order">1</div>
                    <div class="exercise-info">
                        <h3>Lat Pulldown</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">38-12</span>
                            <span class="rir-chip controlled">RIR 1-2</span>
                            <span class="rest-badge" onclick="App.startTimer(event, &#39;2:00&#39;)">2:00</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper" onclick="App.toggleComplete(event, &#39;pull-b-0&#39;)">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Lock thighs under pad tightly</li>
                                <li><span class="step-num">2</span>Keep torso relatively upright (slight lean okay)</li>
                                <li><span class="step-num">3</span>Drive elbows down towards hips</li>
                                <li><span class="step-num">4</span>Control the ascent to full stretch</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon"></span>Leaning back too far (turns into a row)</li>
                                <li><span class="mistake-icon"></span>Using momentum to start the pull</li>
                                <li><span class="mistake-icon"></span>Shrugging at the ears</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">Dragging the Wall</span>
                            <p class="tip-text">Visualize your elbows dragging down along a wall behind you.</p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">Use lifting straps here. Taking your grip strength out of the equation
                                allows you to push the lats to true failure without your forearms giving out first.</p>
                        </div>
                    </div>
                </div>
            </article>

            <article class="card" id="pull-b-1" onclick="App.toggleCard(&#39;pull-b-1&#39;)">
                <div class="card-header">
                    <div class="exercise-order">2</div>
                    <div class="exercise-info">
                        <h3>Seated Leg Curl</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">310-15</span>
                            <span class="rir-chip intense">RIR 0</span>
                            <span class="rest-badge" onclick="App.startTimer(event, &#39;2:00&#39;)">2:00</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper" onclick="App.toggleComplete(event, &#39;pull-b-1&#39;)">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Align knee with pivot</li>
                                <li><span class="step-num">2</span>Lock the thigh pad down hard onto legs</li>
                                <li><span class="step-num">3</span>Drive heels back and under</li>
                                <li><span class="step-num">4</span>Control the eccentric release (3 seconds)</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon"></span>Hips lifting off the seat (cheating)</li>
                                <li><span class="mistake-icon"></span>Dorsiflexing toes (keep ankles relaxed or
                                    neutral)</li>
                                <li><span class="mistake-icon"></span>Bouncing out of the stretched position</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">Digging a Trench</span>
                            <p class="tip-text">Imagine you're trying to dig a trench in the ground using your heels.
                            </p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">The seated curl places the hamstrings in a lengthened position (because
                                the hips are flexed). This makes it superior to the lying leg curl for hypertrophy. Grip
                                the handles tight to brace yourself into the seat.</p>
                        </div>
                    </div>
                </div>
            </article>

            <article class="card " id="pull-b-2" onclick="App.toggleCard(&#39;pull-b-2&#39;)">
                <div class="card-header">
                    <div class="exercise-order">3</div>
                    <div class="exercise-info">
                        <h3>Wide Grip Cable Row</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">310-12</span>
                            <span class="rir-chip controlled">RIR 1-2</span>
                            <span class="rest-badge" onclick="App.startTimer(event, &#39;2:00&#39;)">2:00</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper" onclick="App.toggleComplete(event, &#39;pull-b-2&#39;)">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Use a wide mag-grip or straight bar</li>
                                <li><span class="step-num">2</span>Keep torso upright (minimal sway)</li>
                                <li><span class="step-num">3</span>Pull elbows high and wide (shoulder height)</li>
                                <li><span class="step-num">4</span>Squeeze scapula together</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon"></span>Pulling elbows into sides (hits lats, not upper
                                    back)</li>
                                <li><span class="mistake-icon"></span>Rounding the back (spine safety)</li>
                                <li><span class="mistake-icon"></span>Excessive leaning back</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">Scarecrow Pull</span>
                            <p class="tip-text">Pull your elbows apart like a scarecrow. The goal is width.</p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">By flaring the elbows out to 45-60 degrees, you bias the upper back
                                (traps, rhomboids, rear delts) rather than the lats.</p>
                        </div>
                    </div>
                </div>
            </article>

            <article class="card " id="pull-b-3" onclick="App.toggleCard(&#39;pull-b-3&#39;)">
                <div class="card-header">
                    <div class="exercise-order">4</div>
                    <div class="exercise-info">
                        <h3>Face Pulls</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">215-20</span>
                            <span class="rir-chip intense">RIR 0</span>
                            <span class="rest-badge" onclick="App.startTimer(event, &#39;90s&#39;)">90s</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper" onclick="App.toggleComplete(event, &#39;pull-b-3&#39;)">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Set rope to upper chest height</li>
                                <li><span class="step-num">2</span>Grasp rope with thumbs facing back (hammer grip)</li>
                                <li><span class="step-num">3</span>Pull towards forehead while spreading hands</li>
                                <li><span class="step-num">4</span>Externally rotate (hands finish behind ears)</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon"></span>Pulling to the chin/neck</li>
                                <li><span class="mistake-icon"></span>Keeping hands close together</li>
                                <li><span class="mistake-icon"></span>Using bodyweight to pull</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">Double Bicep Pose</span>
                            <p class="tip-text">Finish the movement in a "double bicep" pose. Your knuckles should be
                                facing the wall behind you.</p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">This is not a heavy strength movement. It's for rotator cuff health and
                                rear delts. If you go too heavy, your internal rotators (pecs/lats) will take over,
                                defeating the purpose.</p>
                        </div>
                    </div>
                </div>
            </article>

            <article class="card " id="pull-b-4" onclick="App.toggleCard(&#39;pull-b-4&#39;)">
                <div class="card-header">
                    <div class="exercise-order">5</div>
                    <div class="exercise-info">
                        <h3>Preacher Curl</h3>
                        <div class="meta-row">
                            <span class="meta-pill accent">210-15</span>
                            <span class="rir-chip intense">RIR 0</span>
                            <span class="rest-badge" onclick="App.startTimer(event, &#39;90s&#39;)">90s</span>
                        </div>
                    </div>
                    <div class="checkbox-wrapper" onclick="App.toggleComplete(event, &#39;pull-b-4&#39;)">
                        <svg class="check-icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
                        </svg>
                    </div>
                </div>
                <div class="details-wrapper">
                    <div class="details-inner">
                        <div class="glass-inner-panel">
                            <span class="label-pill">Technique</span>
                            <ol class="technique-list">
                                <li><span class="step-num">1</span>Adjust seat so armpit fits snugly over pad</li>
                                <li><span class="step-num">2</span>Extend arm fully</li>
                                <li><span class="step-num">3</span>Curl weight without moving the upper arm</li>
                                <li><span class="step-num">4</span>Squeeze biceps at the top</li>
                            </ol>
                        </div>
                        <div class="glass-inner-panel mistakes-panel">
                            <span class="label-pill warning">Common Mistakes</span>
                            <ul class="mistakes-list">
                                <li><span class="mistake-icon"></span>Leaning back to gain leverage</li>
                                <li><span class="mistake-icon"></span>Lifting elbows off the pad</li>
                                <li><span class="mistake-icon"></span>Stopping short of full extension</li>
                            </ul>
                        </div>
                        <div class="glass-inner-panel viz-panel">
                            <span class="label-pill accent">The Hinge</span>
                            <p class="tip-text">Your arm is a simple hinge. Nothing else in the body moves.</p>
                        </div>
                        <div class="glass-inner-panel pro-panel">
                            <span class="label-pill pro">Pro Tip</span>
                            <p class="tip-text">This exercises the biceps in the "shortened position." However, be
                                careful at the very bottom (full extension)the load is high there. Control the negative
                                to avoid tendon strain.</p>
                        </div>
                    </div>
                </div>
            </article>
        </div>

        <div class="spacer"></div>
    </div>

    <!-- Navigation Dock Container (Grouping Dock + AI Button) -->
    <div class="nav-dock-container">
        <nav class="nav-dock" id="nav-dock">
            <div class="nav-item" data-day="0">
                <span class="nav-day">Day 1</span>
                <span class="nav-text">Push A</span>
            </div>
            <div class="nav-item" data-day="1">
                <span class="nav-day">Day 2</span>
                <span class="nav-text">Pull A</span>
            </div>
            <div class="nav-item" data-day="2">
                <span class="nav-day">Day 3</span>
                <span class="nav-text">Push B</span>
            </div>
            <div class="nav-item" data-day="3">
                <span class="nav-day">Day 4</span>
                <span class="nav-text">Pull B</span>
            </div>
        </nav>

        <!-- AI Trigger Button (Now inside the flex container) -->
        <div id="ai-trigger-btn" onclick="MrCoach.toggle()">
            <!-- Minimalist Robot/Chat Icon via SVG (No face) -->
            <svg viewBox="0 0 24 24">
                <path
                    d="M19 2H5C3.34 2 2 3.34 2 5V15C2 16.66 3.34 18 5 18H8L12 22L16 18H19C20.66 18 22 16.66 22 15V5C22 3.34 20.66 2 19 2Z" />
            </svg>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chat-overlay">
        <div id="chat-window">
            <div class="chat-header">
                <div class="chat-title">
                    <div class="bot-avatar"></div>
                    Mr. Coach
                </div>
                <div style="display:flex; gap:10px">
                    <div class="icon-btn" onclick="MrCoach.toggleSettings()"></div>
                    <div class="icon-btn" onclick="MrCoach.toggle()"></div>
                </div>
            </div>

            <div id="api-settings">
                <input type="text" id="api-key-input" placeholder="Paste Google API Key here..."
                    style="flex:1; padding: 6px; border-radius: 4px; border:none; background:white; color:black;">
                <button onclick="MrCoach.saveKey()"
                    style="padding: 6px 12px; border-radius: 4px; border:none; background: var(--accent-color); color:white; cursor:pointer;">Save</button>
            </div>

            <div id="chat-body"></div>

            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Ask coach...">
                <button id="chat-send" onclick="MrCoach.send()"></button>
            </div>
        </div>
    </div>

    <script>
        const DATA = [
            {
                id: 'push-a', accent: 'accent-push-a',
                title: 'Push A', subtitle: 'Quad Bias + Chest Development',
                focusLabel: "Today's Focus", focusText: 'High-frequency quad training with compound pressing movements.',
                exercises: [
                    {
                        name: 'Pendulum Squat', sets: '36-10', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Place feet low on platform at shoulder width', 'Unrack and descend slowly (3-4 seconds)', 'Drive knees forward over toes as deep as possible', 'Drive up through mid-foot, stopping short of lockout'],
                        mistakes: ['Cutting depth (ego lifting)', 'Allowing heels to rise off platform', 'Locking knees at the top (removes tension from quads)'],
                        visualization: 'The Piston Cue',
                        vizText: 'Imagine your femurs are pistons compressing a giant spring at the bottom. The goal is to close the angle between your calf and hamstring as much as possible.',
                        proTip: 'By not locking out, you induce "vascular occlusion" (the burn), forcing the Type II fibers to activate earlier in the set.'
                    },
                    {
                        name: 'Low Incline DB Press', sets: '36-10', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Retract scapula slightly into the bench', 'Lower dumbbells with elbows tucked at ~45', 'Lower deep until dumbbells touch the outer chest fibers', 'Press up and slightly inward, but do not touch weights together'],
                        mistakes: ['Flaring elbows to 90 (shoulders take over)', 'Bouncing at the bottom', 'Pressing straight up (missing the adduction function of the pec)'],
                        visualization: 'The "Bicep to Pec" Cue',
                        vizText: "Don't think about pushing the dumbbells up. Instead, think about trying to touch your inner bicep to your pectorals.",
                        proTip: 'A 15 incline is biomechanically superior for "upper chest" for many people than 45 because it aligns better with the clavicular fibers without excessive front delt dominance.'
                    },
                    {
                        name: 'Cable Lateral Raise', sets: '310-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Set cables to wrist height behind you or between legs', 'Cross cables (left hand grabs right cable)', 'Raise arms out and away toward the walls', 'Stop when arms are parallel to the floor'],
                        mistakes: ['Shrugging (traps engaging)', 'Swinging the torso', 'Keeping arms perfectly straight (keep a soft bend)'],
                        visualization: 'Reaching for the Walls',
                        vizText: "Imagine you're standing in a narrow hallway and trying to touch the walls on either side of you. You're sweeping out, not lifting up.",
                        proTip: 'The "cross body" setup places the side delt in a fully stretched position at the start. Initiate the movement slowly to avoid jerking out of this stretch.'
                    },
                    {
                        name: 'Cable Flys', sets: '210-15', rir: '0', rirClass: 'intense', rest: '2:00',
                        technique: ['Set pulleys at chest height', 'Step forward, keep chest high', 'Open arms wide, letting elbows travel behind torso', 'Squeeze hands together (imagine hugging a tree)'],
                        mistakes: ['Turning it into a press (bending elbows too much)', 'Clanging handles together (loss of tension)', 'Rounding shoulders forward at the contraction'],
                        visualization: 'The Barrel Hug',
                        vizText: "Imagine you're hugging a massive oak tree. Your elbows must stay fixed in a slightly bent position.",
                        proTip: "Pause for a full second in the stretched position (arms back). This is where hypertrophy signaling is highest. Don't worry about touching hands at the top; the tension drops off there anyway."
                    },
                    {
                        name: 'Overhead Extension', sets: '210-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Set pulley at hip height, face away', 'Keep elbows near ears/head', 'Extend arms overhead, separating the rope', 'Control the lowering phase completely'],
                        mistakes: ['Letting elbows flare too wide', 'Arching the lower back to help move weight', 'Shortening the range (not going deep enough behind head)'],
                        visualization: 'Throwing the Ball',
                        vizText: 'Visualize throwing a heavy medicine ball directly over your head to someone standing behind you.',
                        proTip: 'At the very top, turn your wrists out (pronate). This fully shortens the tricep. However, the money is in the stretchlet the rope pull your hands deep behind your neck.'
                    }
                ]
            },
            {
                id: 'pull-a', accent: 'accent-pull-a',
                title: 'Pull A', subtitle: 'Hinge Bias + Lat Width',
                focusLabel: "Today's Focus", focusText: 'Posterior Chain Loading & Vertical Pulling.',
                exercises: [
                    {
                        name: 'Romanian Deadlift', sets: '36-8', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Stand shoulder width, unlock knees (slight bend)', 'Hinge exclusively at the hips (push butt back)', 'Slide bar down thighs/shins', 'Stop when hips stop moving back, squeeze glutes to return'],
                        mistakes: ['"Squatting" the weight (too much knee bend)', 'Rounding the lumbar spine', 'Going too low (flexing spine instead of hips)'],
                        visualization: 'Car Door',
                        vizText: 'Imagine your hands are full of groceries and you have to close a car door behind you using only your butt. Push back, back, back.',
                        proTip: 'Range of motion is determined by your hamstring flexibility. The moment your hips stop traveling backward, the rep is over. Going lower just transfers tension to your lower back.'
                    },
                    {
                        name: 'Weighted Pull-Up', sets: '36-10', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Use a neutral grip (palms facing each other)', 'Depress shoulders (reverse shrug) before bending elbows', 'Pull chest to bar', 'Lower under control'],
                        mistakes: ['Kipping/swinging', 'Rolling shoulders forward at the top', 'Not going to full hang'],
                        visualization: 'Elbows to Pockets',
                        vizText: "Don't think about pulling your body up. Visualize driving your elbows down into your back pockets.",
                        proTip: 'The neutral grip biases the lats and brachialis while being safer on the shoulders. If you cannot do weighted, do bodyweight or assisted, but keep the rep range low (6-10) to stimulate mechanical tension.'
                    },
                    {
                        name: 'Reverse Pec Deck', sets: '212-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Adjust seat so handles are at shoulder height', 'Push handles back with the back of your hands', 'Keep arms slightly bent but rigid', 'Stop when arms are in line with the body'],
                        mistakes: ['Squeezing shoulder blades together (traps take over)', 'Using a "rowing" motion', 'Excessive momentum'],
                        visualization: 'Pushing Walls Away',
                        vizText: "Imagine you're in a shrinking room and you're pushing the walls away with the backs of your hands.",
                        proTip: 'We want to isolate the rear delt. If you squeeze your shoulder blades (scapular retraction), the traps take over. Keep your shoulder blades wide and immobile; move only the arm bone (humerus).'
                    },
                    {
                        name: 'Chest-Supported Row', sets: '38-12', rir: '1-2', rirClass: 'controlled', rest: '2:00',
                        technique: ['Glue chest to the pad', 'Use a pronated (overhand) or wide neutral grip', 'Protract (stretch) shoulders at bottom', 'Retract (squeeze) shoulders at top'],
                        mistakes: ['Lifting chest off pad to use momentum', 'Pulling with biceps (curling the weight)', 'Neck-cranking (looking up too high)'],
                        visualization: 'Wrap Around the Pad',
                        vizText: 'At the bottom, let the weight pull your shoulders forward so you feel your back "wrapping around" the pad. At the top, crack a walnut between your shoulder blades.',
                        proTip: 'This is for upper back (rhomboids/traps/rear delts). Unlike the pull-up (lats), here we want the shoulder blades to move dynamically.'
                    },
                    {
                        name: 'Incline DB Curls', sets: '210-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Set bench to 45-60', 'Lay back, let arms hang perpendicular to floor', 'Curl up while keeping elbows pointed at floor', 'Supinate (twist pinky up) at the top'],
                        mistakes: ['Swinging elbows forward (front delt help)', 'Lifting head off bench', 'Not fully extending arm at bottom'],
                        visualization: 'Elbows in Cement',
                        vizText: 'Imagine your elbows are encased in cement blocks fixed to the floor. They can hinge, but they cannot move forward, backward, or sideways.',
                        proTip: "This targets the 'long head' of the biceps via the stretch. The stretch is the most anabolic part of this movementdon't cut the bottom short."
                    }
                ]
            },
            {
                id: 'push-b', accent: 'accent-push-b',
                title: 'Push B', subtitle: 'Quad Isolation + Upper Chest Focus',
                focusLabel: "Today's Focus", focusText: 'Pre-Exhausting Quads + Vertical Pressing.',
                exercises: [
                    {
                        name: 'Leg Extension', sets: '310-15', rir: '0', rirClass: 'intense', rest: '2:00',
                        technique: ['Align knee joint with machine pivot point', 'Dorsiflex ankles (pull toes toward shins)', 'Kick up and hold for 1 second at the top', 'Lower slowly (3-second eccentric)'],
                        mistakes: ['Kicking explosively (momentum)', 'Butt coming off the seat', 'Partial reps at the bottom'],
                        visualization: 'The "Glue" Cue',
                        vizText: "Imagine your butt is super-glued to the seat. If you have to lift your hips to move the weight, it's too heavy.",
                        proTip: "Dorsiflexing the toes (pulling them up) reduces calf involvement and increases rectus femoris activation. This is your only direct rectus femoris work (squats don't hit it well)."
                    },
                    {
                        name: 'Seated OHP', sets: '36-10', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Set bench to 75-80 (not fully 90)', 'Lower bar/handles to chin level', 'Press vertically, finishing with biceps by ears', 'Control the descent'],
                        mistakes: ['Arching back into a chest press', 'Cutting ROM (stopping at forehead)', 'Flaring elbows completely to sides (unsafe for rotator cuff)'],
                        visualization: 'Head Through Window',
                        vizText: 'As you press up, imagine pushing your head slightly forward "through the window" created by your arms (without moving your torso).',
                        proTip: 'Using a machine or Smith here is preferred over free weights for hypertrophy, as stability requirements are lower, allowing you to grind closer to failure safely.'
                    },
                    {
                        name: 'Machine Lateral Raise', sets: '310-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Place elbows against pads', 'Keep chest supported against the pad', 'Drive elbows up/out leading the movement', 'Lower with resistance'],
                        mistakes: ['Gripping the handles too tight (activates forearms)', 'Shrugging shoulders up'],
                        visualization: 'Puppet Strings',
                        vizText: 'Imagine strings are attached to your elbows, pulling them up to the ceiling. Your hands are just hooks; they do no work.',
                        proTip: "This is an 'active rest' for your triceps and chest before the next heavy press. Keep your traps relaxed and depressed."
                    },
                    {
                        name: 'High Incline Smith Press', sets: '38-12', rir: '1-2', rirClass: 'controlled', rest: '3:00',
                        technique: ['Set bench to 45', 'Lower bar toward the clavicle (upper chest/neck base)', 'Pause briefly on the chest', 'Press up to 90% lockout'],
                        mistakes: ['Lowering to the nipple line (too low for 45)', 'Bouncing off the chest', 'Elbows flaring too wide (shoulder impingement risk)'],
                        visualization: 'Scraping the Chin',
                        vizText: "The bar path is fixed. You must position your body so the bar feels like it's almost going to scrape your chin on the way down. This isolates the clavicular (upper) pec.",
                        proTip: 'Since your front delts are fatigued from the OHP, your stabilizers are shot. The Smith machine is crucial here to allow you to safely push the upper pecs to failure without dropping the weight.'
                    },
                    {
                        name: 'Triceps Pushdown', sets: '210-15', rir: '0', rirClass: 'intense', rest: '60s',
                        technique: ['Pin elbows to your ribcage', 'Hinge only at the elbow', 'Pull the rope apart at the bottom', 'Squeeze triceps hard'],
                        mistakes: ['Shoulders rolling forward / leaning on the rope', 'Moving the elbows forward and back', 'Using momentum'],
                        visualization: 'Breaking the Rope',
                        vizText: "Don't just push down. Visualize trying to rip the rope in half as you reach the bottom of the movement.",
                        proTip: "This targets the lateral and medial heads of the triceps. Keep the tempo strict. If your shoulders roll forward, you're using your chestdrop the weight."
                    }
                ]
            },
            {
                id: 'pull-b', accent: 'accent-pull-b',
                title: 'Pull B', subtitle: 'Hamstring Isolation + Upper Back Bias',
                focusLabel: "Today's Focus", focusText: 'Shortened Position Hamstrings + Horizontal Pulling.',
                exercises: [
                    {
                        name: 'Lat Pulldown', sets: '38-12', rir: '1-2', rirClass: 'controlled', rest: '2:00',
                        technique: ['Lock thighs under pad tightly', 'Keep torso relatively upright (slight lean okay)', 'Drive elbows down towards hips', 'Control the ascent to full stretch'],
                        mistakes: ['Leaning back too far (turns into a row)', 'Using momentum to start the pull', 'Shrugging at the ears'],
                        visualization: 'Dragging the Wall',
                        vizText: 'Visualize your elbows dragging down along a wall behind you.',
                        proTip: 'Use lifting straps here. Taking your grip strength out of the equation allows you to push the lats to true failure without your forearms giving out first.'
                    },
                    {
                        name: 'Seated Leg Curl', sets: '310-15', rir: '0', rirClass: 'intense', rest: '2:00',
                        technique: ['Align knee with pivot', 'Lock the thigh pad down hard onto legs', 'Drive heels back and under', 'Control the eccentric release (3 seconds)'],
                        mistakes: ['Hips lifting off the seat (cheating)', 'Dorsiflexing toes (keep ankles relaxed or neutral)', 'Bouncing out of the stretched position'],
                        visualization: 'Digging a Trench',
                        vizText: "Imagine you're trying to dig a trench in the ground using your heels.",
                        proTip: 'The seated curl places the hamstrings in a lengthened position (because the hips are flexed). This makes it superior to the lying leg curl for hypertrophy. Grip the handles tight to brace yourself into the seat.'
                    },
                    {
                        name: 'Wide Grip Cable Row', sets: '310-12', rir: '1-2', rirClass: 'controlled', rest: '2:00',
                        technique: ['Use a wide mag-grip or straight bar', 'Keep torso upright (minimal sway)', 'Pull elbows high and wide (shoulder height)', 'Squeeze scapula together'],
                        mistakes: ['Pulling elbows into sides (hits lats, not upper back)', 'Rounding the back (spine safety)', 'Excessive leaning back'],
                        visualization: 'Scarecrow Pull',
                        vizText: 'Pull your elbows apart like a scarecrow. The goal is width.',
                        proTip: 'By flaring the elbows out to 45-60 degrees, you bias the upper back (traps, rhomboids, rear delts) rather than the lats.'
                    },
                    {
                        name: 'Face Pulls', sets: '215-20', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Set rope to upper chest height', 'Grasp rope with thumbs facing back (hammer grip)', 'Pull towards forehead while spreading hands', 'Externally rotate (hands finish behind ears)'],
                        mistakes: ['Pulling to the chin/neck', 'Keeping hands close together', 'Using bodyweight to pull'],
                        visualization: 'Double Bicep Pose',
                        vizText: 'Finish the movement in a "double bicep" pose. Your knuckles should be facing the wall behind you.',
                        proTip: 'This is not a heavy strength movement. It\'s for rotator cuff health and rear delts. If you go too heavy, your internal rotators (pecs/lats) will take over, defeating the purpose.'
                    },
                    {
                        name: 'Preacher Curl', sets: '210-15', rir: '0', rirClass: 'intense', rest: '90s',
                        technique: ['Adjust seat so armpit fits snugly over pad', 'Extend arm fully', 'Curl weight without moving the upper arm', 'Squeeze biceps at the top'],
                        mistakes: ['Leaning back to gain leverage', 'Lifting elbows off the pad', 'Stopping short of full extension'],
                        visualization: 'The Hinge',
                        vizText: 'Your arm is a simple hinge. Nothing else in the body moves.',
                        proTip: 'This exercises the biceps in the "shortened position." However, be careful at the very bottom (full extension)the load is high there. Control the negative to avoid tendon strain.'
                    }
                ]
            }
        ];

        // Initialize the application
        // Made global (window.App) AND local (const App) to ensure access everywhere
        const MrCoach = {
            apiKey: '', // SECURITY: Key must be entered by user via Settings
            history: [],
            awaitingKey: false, // Flag for chat-based key entry

            init() {
                // Check if user has stored key
                const stored = localStorage.getItem('mr_Coach_key');
                if (stored) this.apiKey = stored;

                // Bind Enter key
                const input = document.getElementById('chat-input');
                if (input) {
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault(); // Prevent default newline if it's a textarea, or form submit
                            this.send();
                        }
                    });

                    // Mobile UX: Scroll to bottom on focus to prevent hiding content behind keyboard
                    input.addEventListener('focus', () => {
                        setTimeout(() => {
                            const body = document.getElementById('chat-body');
                            body.scrollTop = body.scrollHeight;
                            // Also ensure the window itself is in view (helper for some browsers)
                            if (window.visualViewport) {
                                // optional: logic to adjust height if needed
                            }
                        }, 300);
                    });
                }
            },

            toggle() {
                const overlay = document.getElementById('chat-overlay');
                const btn = document.getElementById('ai-trigger-btn');
                const win = document.getElementById('chat-window');
                const isOpen = overlay.classList.contains('active');

                if (!isOpen) {
                    // 1. Prepare for calculation (make visible but hidden visually)
                    overlay.style.visibility = 'hidden';
                    overlay.style.display = 'flex'; // Ensure flex layout applies
                    overlay.classList.add('active'); // Temporarily add to get dimensions

                    // 2. Get fresh coordinates
                    const btnRect = btn.getBoundingClientRect();
                    const winRect = win.getBoundingClientRect();

                    // 3. Reset state
                    overlay.classList.remove('active');
                    overlay.style.visibility = '';
                    overlay.style.display = '';

                    // 4. Calculate Center Delta
                    // Origin should be the Button's Center relative to the Window's Top-Left
                    const btnCenterX = btnRect.left + btnRect.width / 2;
                    const btnCenterY = btnRect.top + btnRect.height / 2;

                    const originX = btnCenterX - winRect.left;
                    const originY = btnCenterY - winRect.top;

                    win.style.setProperty('--origin-x', `${originX}px`);
                    win.style.setProperty('--origin-y', `${originY}px`);

                    // 5. Trigger Animation
                    // Force Layout flusht
                    void win.offsetWidth;

                    document.body.classList.add('chat-open');
                    overlay.classList.add('active');

                    setTimeout(() => {
                        const input = document.getElementById('chat-input');
                        if (input) input.focus();
                    }, 100);

                    // Check API key on open
                    if (!this.apiKey && this.history.length === 0) {
                        this.addMessage('ai', "Greetings. I am Mr. Coach. To begin, please paste your Gemini API Key here.");
                        this.awaitingKey = true;
                    }
                } else {
                    document.body.classList.remove('chat-open');
                    overlay.classList.remove('active');
                }
            },

            toggleSettings() {
                document.getElementById('api-settings').classList.toggle('show');
            },

            saveKey() {
                const key = document.getElementById('api-key-input').value.trim();
                this._persistKey(key);
            },

            _persistKey(key) {
                if (key) {
                    this.apiKey = key;
                    localStorage.setItem('mr_Coach_key', key);
                    this.addMessage('system', "API Key saved securely.");

                    if (this.awaitingKey) {
                        this.awaitingKey = false;
                        this.addMessage('ai', "Thank you. Access granted. How can I help you with your training today?");
                    }

                    // Also update input if visible
                    const input = document.getElementById('api-key-input');
                    if (input) input.value = key;

                    // Hide settings if open
                    document.getElementById('api-settings').classList.remove('show');
                }
            },

            addMessage(role, text) {
                this.history.push({ role, text });
                const div = document.createElement('div');
                div.className = `chat-message ${role}`;
                // Basic markdown-ish formatting
                let formatted = text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>');
                div.innerHTML = formatted;

                const body = document.getElementById('chat-body');
                body.appendChild(div);
                body.scrollTop = body.scrollHeight;
            },

            showTyping() {
                const div = document.createElement('div');
                div.id = 'typing-indicator';
                div.className = 'chat-message ai';
                div.innerHTML = '<span style="animation: pulse 1s infinite">Thinking...</span>';
                document.getElementById('chat-body').appendChild(div);
                document.getElementById('chat-body').scrollTop = document.getElementById('chat-body').scrollHeight;
            },

            hideTyping() {
                const el = document.getElementById('typing-indicator');
                if (el) el.remove();
            },

            async verifyAndSaveKey(rawInput) {
                const key = rawInput.trim();

                // 1. Basic format check (reject obviously wrong inputs locally)
                if (key.length < 30 || key.includes(' ')) {
                    this.addMessage('ai', "That doesn't look like a valid API key (too short or contains spaces). Please check and try again.");
                    return;
                }

                // 2. Real verification: Try to generate 1 token
                this.addMessage('system', "Verifying API key...");
                this.showTyping();

                try {
                    // Use a lightweight GET request to check validity (avoids quota usage/generation errors)
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}&pageSize=1`);
                    const data = await response.json();

                    this.hideTyping();

                    if (!response.ok || data.error) {
                        console.warn("API Verification Failed:", data.error);
                        const msg = data.error ? data.error.message : "Invalid API Key";
                        this.addMessage('ai', `Verification failed: ${msg}. Please check your key.`);
                    } else {
                        // Success! (If we got models back, the key is valid)
                        this._persistKey(key);
                    }

                } catch (e) {
                    this.hideTyping();
                    console.error("API Verification Error:", e);
                    this.addMessage('ai', "Could not verify key (Network error). Please check your internet connection and try again.");
                }
            },

            async send() {
                const input = document.getElementById('chat-input');
                const text = input.value.trim();
                if (!text) return;

                input.value = '';
                this.addMessage('user', text);

                // Setup Logic: If waiting for key, intercept the message
                if (this.awaitingKey) {
                    this.verifyAndSaveKey(text);
                    return;
                }

                if (!this.apiKey) {
                    this.addMessage('ai', "I require a Google Gemini API Key. Please paste it below.");
                    this.awaitingKey = true;
                    return;
                }

                this.showTyping();

                try {
                    // Context Preparation
                    const dayTitle = document.getElementById('day-title') ? document.getElementById('day-title').innerText : "Training";
                    const dayFocus = document.getElementById('theme-text') ? document.getElementById('theme-text').innerText : "General Hypertrophy";

                    const systemPrompt = `You are Mr. Coach, an elite, evidence-based hypertrophy coach.
You are embedded in a specific training app. 
Current Context:
- User is currently viewing: ${dayTitle}
- Day Focus: ${dayFocus}
- Full Program Data: ${JSON.stringify(DATA)}

Rules:
1. Be concise, motivating, and strictly scientific.
2. No 'bro-science'. Use terms like 'Stimulus-to-Fatigue', 'Lengthened Position', 'RIR'.
3. If asked about swaps, suggest biomechanically similar movements.
4. You value intensity. Remind the user about controlling eccentrics.
`;

                    const finalPrompt = systemPrompt + "\n\nUser: " + text;
                    const payload = {
                        contents: [{
                            parts: [{ text: finalPrompt }]
                        }]
                    };

                    // Implement Fallback Strategy
                    // We prioritize models that are most likely to work with standard keys

                    const tryModel = async (modelName) => {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${this.apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const data = await response.json();
                        if (data.error) throw new Error(data.error.message);
                        return data.candidates[0].content.parts[0].text;
                    };

                    let reply;
                    try {
                        // User suggestion + Latest Stable
                        reply = await tryModel('gemini-1.5-flash');
                    } catch (e) {
                        console.warn('gemini-1.5-flash failed, trying user suggestion/next...', e);
                        try {
                            reply = await tryModel('gemini-2.0-flash-exp'); // Newest experimental
                        } catch (e2) {
                            console.warn('gemini-2.0-flash failed, trying gemini-pro...', e2);
                            try {
                                reply = await tryModel('gemini-pro');
                            } catch (e3) {
                                // Last resort: User mentioned "2.5", trying just in case
                                reply = await tryModel('gemini-2.5-flash');
                            }
                        }
                    }

                    this.hideTyping();
                    this.addMessage('ai', reply);

                } catch (e) {
                    this.hideTyping();
                    this.addMessage('system', `Error: ${e.message}. Please check your API Key and ensure you have access to Gemini models.`);
                }
            }
        };

        const App = window.App = {
            state: { day: 0, completed: {}, timerInterval: null, timerSeconds: 0 },

            init() {
                // Set theme based on system preference (default to dark if no preference)
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (!prefersDark) {
                    document.body.setAttribute('data-theme', 'light');
                } else {
                    document.body.setAttribute('data-theme', 'dark');
                }

                // Studio 2026: Load persisted session state from localStorage
                this.loadSessionState();

                this.cache();

                // Fix: Ensure we start at top with full header
                this.el.container.scrollTop = 0;
                this.el.header.classList.remove('scrolled');

                this.bind();

                // Fix: Ensure nav state matches initial state
                this.updateNav(this.state.day);
                this.render(this.state.day);

                // Studio 2026: Auto-expand first incomplete exercise after initial render
                // Removed: user wants all closed by default
                // setTimeout(() => this.autoExpandFirstIncomplete(), 400);
            },

            // Studio 2026: Session persistence - load state from localStorage
            loadSessionState() {
                const today = new Date().toDateString();
                const savedDate = localStorage.getItem('hypertrophy-session-date');

                // Only restore if same day (sessions expire after midnight)
                if (savedDate === today) {
                    try {
                        const saved = localStorage.getItem('hypertrophy-completed');
                        if (saved) this.state.completed = JSON.parse(saved);
                    } catch (e) {
                        console.warn('Failed to load session state:', e);
                    }
                } else {
                    // New day, clear old session
                    localStorage.removeItem('hypertrophy-completed');
                    localStorage.setItem('hypertrophy-session-date', today);
                }
            },

            // Studio 2026: Session persistence - save state to localStorage
            saveSessionState() {
                localStorage.setItem('hypertrophy-completed', JSON.stringify(this.state.completed));
                localStorage.setItem('hypertrophy-session-date', new Date().toDateString());
            },

            // Studio 2026: Muscle Map - Exercise to Muscle Group Mapping
            MUSCLE_MAP: {
                // Push A exercises
                'Pendulum Squat': ['quads', 'glutes'],
                'Low Incline DB Press': ['chest', 'shoulders', 'triceps'],
                'Cable Lateral Raise': ['shoulders'],
                'Cable Flys': ['chest'],
                'Overhead Extension': ['triceps'],
                // Pull A exercises
                'Romanian Deadlift': ['hamstrings', 'glutes', 'back'],
                'Weighted Pull-Up': ['back', 'biceps'],
                'Reverse Pec Deck': ['shoulders', 'back'],
                'Chest-Supported Row': ['back'],
                'Incline DB Curls': ['biceps'],
                // Push B exercises
                'Leg Extension': ['quads'],
                'Seated OHP': ['shoulders', 'triceps'],
                'Machine Lateral Raise': ['shoulders'],
                'High Incline Smith Press': ['chest', 'shoulders'],
                'Triceps Pushdown': ['triceps'],
                // Pull B exercises
                'Lat Pulldown': ['back', 'biceps'],
                'Seated Leg Curl': ['hamstrings'],
                'Wide Grip Cable Row': ['back'],
                'Face Pulls': ['shoulders', 'back'],
                'Preacher Curl': ['biceps']
            },

            // Get muscles targeted by current day
            getDayMuscles(dayId) {
                const day = DATA.find(d => d.id === dayId);
                if (!day) return [];
                const muscles = new Set();
                day.exercises.forEach(ex => {
                    const mapping = this.MUSCLE_MAP[ex.name] || [];
                    mapping.forEach(m => muscles.add(m));
                });
                return [...muscles];
            },

            // Get muscles fully completed (all exercises targeting them are done)
            getCompletedMuscles(dayId) {
                const day = DATA.find(d => d.id === dayId);
                if (!day) return [];

                // Group exercises by muscle
                const muscleExercises = {};
                day.exercises.forEach((ex, i) => {
                    const mapping = this.MUSCLE_MAP[ex.name] || [];
                    mapping.forEach(m => {
                        if (!muscleExercises[m]) muscleExercises[m] = [];
                        muscleExercises[m].push(`${dayId}-${i}`);
                    });
                });

                // Check which muscles have ALL their exercises completed
                const completed = [];
                Object.entries(muscleExercises).forEach(([muscle, exIds]) => {
                    const allDone = exIds.every(id => this.state.completed[id]);
                    if (allDone) completed.push(muscle);
                });
                return completed;
            },

            // Update muscle map visualization
            updateMuscleMap(dayId, justCompletedMuscle = null) {
                const targeted = this.getDayMuscles(dayId);
                const completed = this.getCompletedMuscles(dayId);

                // Muscle ID mapping to SVG element IDs
                const muscleElements = {
                    'chest': ['muscle-chest-l', 'muscle-chest-r'],
                    'shoulders': ['muscle-shoulders-front-l', 'muscle-shoulders-front-r', 'muscle-shoulders-back-l', 'muscle-shoulders-back-r'],
                    'biceps': ['muscle-biceps-l', 'muscle-biceps-r'],
                    'triceps': ['muscle-triceps-l', 'muscle-triceps-r'],
                    'core': ['muscle-core-1', 'muscle-core-2', 'muscle-core-3', 'muscle-obliques-l', 'muscle-obliques-r'],
                    'back': ['muscle-lats-front-l', 'muscle-lats-front-r', 'muscle-lats-l', 'muscle-lats-r', 'muscle-traps-upper', 'muscle-traps-mid', 'muscle-lower-back'],
                    'quads': ['muscle-quads-l', 'muscle-quads-r', 'muscle-quads-inner-l', 'muscle-quads-inner-r'],
                    'hamstrings': ['muscle-hamstrings-l', 'muscle-hamstrings-r'],
                    'glutes': ['muscle-glutes-l', 'muscle-glutes-r'],
                    'calves': ['muscle-calves-front-l', 'muscle-calves-front-r', 'muscle-calves-back-l', 'muscle-calves-back-r']
                };

                Object.entries(muscleElements).forEach(([muscleId, elementIds]) => {
                    elementIds.forEach(elId => {
                        const el = document.getElementById(elId);
                        if (!el) return;

                        el.classList.remove('targeted', 'completed', 'just-completed');

                        if (completed.includes(muscleId)) {
                            el.classList.add('completed');
                            if (justCompletedMuscle === muscleId) {
                                el.classList.add('just-completed');
                                setTimeout(() => el.classList.remove('just-completed'), 600);
                            }
                        } else if (targeted.includes(muscleId)) {
                            el.classList.add('targeted');
                        }
                    });
                });
            },

            cache() {
                this.el = {
                    container: document.getElementById('app-container'),
                    header: document.getElementById('header'),
                    dayTitle: document.getElementById('day-title'),
                    daySubtitle: document.getElementById('day-subtitle'),
                    themeLabel: document.getElementById('theme-label'),
                    themeText: document.getElementById('theme-text'),
                    progressFill: document.getElementById('progress-fill'),
                    cardList: document.getElementById('card-list'),
                    navItems: document.querySelectorAll('.nav-item'),
                    themeToggle: document.getElementById('theme-toggle'),
                    themeIcon: document.getElementById('theme-icon'),
                    timerOverlay: document.getElementById('timer-overlay'),
                    timerDisplay: document.getElementById('timer-display'),
                    timerBtn: document.getElementById('timer-btn'),
                    liquidBg: document.getElementById('liquid-bg')
                };
            },

            bind() {
                // Bug fix: Debounced scroll listener to prevent header jumping
                let scrollTimeout = null;
                let lastScrollState = false;

                this.el.container.addEventListener('scroll', () => {
                    const shouldBeScrolled = this.el.container.scrollTop > 10;

                    // Only update if state actually changed
                    if (shouldBeScrolled !== lastScrollState) {
                        // Clear any pending timeout
                        if (scrollTimeout) clearTimeout(scrollTimeout);

                        // Debounce the class toggle
                        scrollTimeout = setTimeout(() => {
                            if (shouldBeScrolled) {
                                this.el.header.classList.add('scrolled');
                            } else {
                                this.el.header.classList.remove('scrolled');
                            }
                            lastScrollState = shouldBeScrolled;
                        }, 50); // 50ms debounce
                    }
                }, { passive: true });

                // Nav items
                this.el.navItems.forEach(item => {
                    item.addEventListener('click', () => this.goToDay(+item.dataset.day));
                });

                // Theme toggle
                this.el.themeToggle.addEventListener('click', () => this.toggleTheme());

                // Timer
                this.el.timerBtn.addEventListener('click', () => this.stopTimer());
                this.el.timerOverlay.addEventListener('click', e => {
                    if (e.target === this.el.timerOverlay) this.stopTimer();
                });

                // Swipe
                let startX = 0;
                this.el.container.addEventListener('touchstart', e => startX = e.touches[0].clientX, { passive: true });
                this.el.container.addEventListener('touchend', e => {
                    const dx = startX - e.changedTouches[0].clientX;
                    if (Math.abs(dx) > 60) {
                        if (dx > 0 && this.state.day < 3) this.goToDay(this.state.day + 1);
                        else if (dx < 0 && this.state.day > 0) this.goToDay(this.state.day - 1);
                    }
                }, { passive: true });
            },

            toggleTheme() {
                const current = document.body.getAttribute('data-theme');
                const next = current === 'dark' ? 'light' : 'dark';
                document.body.setAttribute('data-theme', next);

                // Update icon
                if (next === 'dark') {
                    this.el.themeIcon.innerHTML = '<path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>';
                } else {
                    this.el.themeIcon.innerHTML = '<path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1z"/>';
                }
            },

            goToDay(index) {
                if (index === this.state.day) return;

                // Update nav
                this.updateNav(index);
                this.state.day = index;

                // UX: Show skeleton loading state
                this.el.cardList.classList.add('loading');

                // Fade out
                this.el.cardList.style.opacity = '0';
                this.el.cardList.style.transform = 'translateY(16px)';

                setTimeout(() => {
                    this.render(index);
                    this.el.cardList.classList.remove('loading');
                    this.el.cardList.style.opacity = '1';
                    this.el.cardList.style.transform = 'translateY(0)';
                    this.el.container.scrollTop = 0;
                    // Removed: auto-expand on day change - user wants all closed by default
                }, 250);
            },

            render(index) {
                const d = DATA[index];

                // Update accent
                document.body.className = d.accent;

                // Update header
                this.el.dayTitle.textContent = d.title;
                this.el.daySubtitle.textContent = d.subtitle;
                this.el.themeLabel.textContent = d.focusLabel;
                this.el.themeText.textContent = d.focusText;

                // Update progress
                this.updateProgress(d.id, d.exercises.length);

                // Render cards
                let html = '';
                d.exercises.forEach((ex, i) => {
                    const id = `${d.id}-${i}`;
                    const isCompleted = this.state.completed[id];

                    // Build technique steps list
                    const techSteps = ex.technique.map((step, idx) =>
                        `<li><span class="step-num">${idx + 1}</span>${step}</li>`
                    ).join('');

                    // Build mistakes list
                    const mistakesList = ex.mistakes.map(m =>
                        `<li><span class="mistake-icon"></span>${m}</li>`
                    ).join('');

                    html += `
                        <article class="card ${isCompleted ? 'completed' : ''}" id="${id}" onclick="window.App.toggleCard('${id}')">
                            <div class="card-header">
                                <div class="exercise-order">${i + 1}</div>
                                <div class="exercise-info">
                                    <h3>${ex.name}</h3>
                                    <div class="meta-row">
                                        <span class="meta-pill accent">${ex.sets}</span>
                                        <span class="rir-chip ${ex.rirClass}">RIR ${ex.rir}</span>
                                        <span class="rest-badge" onclick="window.App.startTimer(event, '${ex.rest}')">${ex.rest}</span>
                                    </div>
                                </div>
                                <div class="checkbox-wrapper" onclick="window.App.toggleComplete(event, '${id}')">
                                    <svg class="check-icon" viewBox="0 0 24 24">
                                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                    </svg>
                                </div>
                                <div class="expand-chevron"></div>
                            </div>
                            <div class="details-wrapper">
                                <div class="details-inner">
                                    <div class="glass-inner-panel">
                                        <span class="label-pill">Technique</span>
                                        <ol class="technique-list">${techSteps}</ol>
                                    </div>
                                    <div class="glass-inner-panel mistakes-panel">
                                        <span class="label-pill warning">Common Mistakes</span>
                                        <ul class="mistakes-list">${mistakesList}</ul>
                                    </div>
                                    <div class="glass-inner-panel viz-panel">
                                        <span class="label-pill accent">${ex.visualization}</span>
                                        <p class="tip-text">${ex.vizText}</p>
                                    </div>
                                    <div class="glass-inner-panel pro-panel">
                                        <span class="label-pill pro">Pro Tip</span>
                                        <p class="tip-text">${ex.proTip}</p>
                                    </div>
                                </div>
                            </div>
                        </article>
                    `;
                });

                // Check All Feature (Bottom of list)
                const allDone = d.exercises.every((ex, i) => this.state.completed[`${d.id}-${i}`]);
                html += `
                    <div class="actions-footer">
                        <button type="button" class="action-btn" id="toggle-all-btn"
                                onclick="window.App.toggleAll('${d.id}')">
                            ${allDone ? 'Uncheck All' : 'Mark Day Complete'}
                        </button>
                    </div>
                `;

                this.el.cardList.innerHTML = html;
                this.el.cardList.style.transition = 'opacity 0.25s ease, transform 0.25s ease';

                // Studio 2026: Update muscle map visualization
                this.updateMuscleMap(d.id);
            },

            updateProgress(dayId, total) {
                const completed = Object.keys(this.state.completed).filter(k => k.startsWith(dayId)).length;
                const percent = (completed / total) * 100;
                const prevPercent = parseFloat(this.el.progressFill.style.width) || 0;

                this.el.progressFill.style.width = percent + '%';

                // Studio 2026: Milestone celebration bursts
                const milestones = [25, 50, 75];
                const crossedMilestone = milestones.find(m => prevPercent < m && percent >= m);

                if (percent === 100 && prevPercent < 100) {
                    // Complete celebration
                    this.el.progressFill.classList.remove('milestone');
                    this.el.progressFill.classList.add('complete');
                    if (navigator.vibrate) navigator.vibrate([50, 30, 50, 30, 80]);
                    setTimeout(() => this.el.progressFill.classList.remove('complete'), 800);
                } else if (crossedMilestone) {
                    // Milestone celebration
                    this.el.progressFill.classList.remove('complete');
                    this.el.progressFill.classList.add('milestone');
                    if (navigator.vibrate) navigator.vibrate([20, 20, 30]);
                    setTimeout(() => this.el.progressFill.classList.remove('milestone'), 600);
                }
            },

            toggleCard(id) {
                document.getElementById(id).classList.toggle('expanded');
            },

            toggleComplete(e, id) {
                // Prevent event from bubbling to card toggle
                e.stopPropagation();
                e.preventDefault();

                // Store expanded state before any changes
                const card = document.getElementById(id);
                const wasExpanded = card.classList.contains('expanded');
                const isCompleting = !this.state.completed[id];

                // Premium haptic vibration pattern
                if (navigator.vibrate) {
                    if (isCompleting) {
                        // Success pattern: short-pause-long
                        navigator.vibrate([15, 50, 30]);
                    } else {
                        // Undo pattern: single tap
                        navigator.vibrate(10);
                    }
                }

                // Get muscles before state change for animation
                const d = DATA[this.state.day];
                const beforeMuscles = this.getCompletedMuscles(d.id);

                if (isCompleting) {
                    this.state.completed[id] = true;
                    card.classList.add('completed');
                    if (card.classList.contains('expanded')) {
                        card.classList.remove('expanded');
                    }
                } else {
                    delete this.state.completed[id];
                    card.classList.remove('completed');
                }

                this.updateProgress(d.id, d.exercises.length);

                // Studio 2026: Persist session state
                this.saveSessionState();

                // Studio 2026: Update muscle map with newly completed highlight
                this.updateMuscleMap(d.id, isCompleting ? id.split('-')[1] : null); // Attempt to highlight relevant muscle
                this.updateMuscleMap(d.id); // Refresh generic state

                // Sync the footer button text with current state
                const allDone = d.exercises.every((ex, i) => this.state.completed[`${d.id}-${i}`]);
                const btn = document.getElementById('toggle-all-btn');
                if (btn) {
                    btn.textContent = allDone ? 'Uncheck All' : 'Mark Day Complete';
                }

                // Auto-advance: open next incomplete exercise after completing one
                if (isCompleting && !allDone) {
                    setTimeout(() => this.autoExpandFirstIncomplete(), 200);
                }
            },

            toggleAll(dayId) {
                const dayData = DATA.find(d => d.id === dayId);
                // IDs are constructed as `dayId-index`, matching renderDay

                // Calculate allDone at CLICK TIME, not render time
                const allDone = dayData.exercises.every((ex, i) =>
                    this.state.completed[`${dayId}-${i}`]
                );
                // If all done, uncheck all. Otherwise, check all.
                const shouldComplete = !allDone;

                dayData.exercises.forEach((ex, i) => {
                    const id = `${dayId}-${i}`;
                    if (shouldComplete) {
                        this.state.completed[id] = true;
                    } else {
                        delete this.state.completed[id];
                    }
                });

                this.updateProgress(dayId, dayData.exercises.length);
                this.updateMuscleMap(dayId);
                this.saveSessionState();

                // Re-render to update button state and card classes
                this.render(this.state.day);
            },


            // UX: Auto-expand first incomplete exercise (called only after completing one)
            autoExpandFirstIncomplete() {
                const d = DATA[this.state.day];
                for (let i = 0; i < d.exercises.length; i++) {
                    const id = `${d.id}-${i}`;
                    if (!this.state.completed[id]) {
                        const card = document.getElementById(id);
                        if (card && !card.classList.contains('expanded')) {
                            // Expand the card first
                            card.classList.add('expanded');
                            // Wait for expansion animation, then scroll to center
                            setTimeout(() => {
                                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 300);
                        }
                        break;
                    }
                }
            },

            startTimer(e, time) {
                e.stopPropagation();
                const parts = time.split(':');
                this.state.timerSeconds = parts.length === 2 ?
                    parseInt(parts[0]) * 60 + parseInt(parts[1]) :
                    parseInt(time) * 60;

                this.updateTimerDisplay();
                this.el.timerOverlay.classList.add('active');
                // Premium haptic: light tap on timer start
                if (navigator.vibrate) navigator.vibrate([10, 30, 15]);

                this.state.timerInterval = setInterval(() => {
                    this.state.timerSeconds--;
                    this.updateTimerDisplay();
                    if (this.state.timerSeconds <= 0) this.timerDone();
                }, 1000);
            },

            updateTimerDisplay() {
                const m = Math.floor(this.state.timerSeconds / 60);
                const s = this.state.timerSeconds % 60;
                this.el.timerDisplay.textContent = `${m}:${s.toString().padStart(2, '0')}`;
            },

            timerDone() {
                this.stopTimer();
                if (navigator.vibrate) navigator.vibrate([80, 40, 80]);
            },

            stopTimer() {
                clearInterval(this.state.timerInterval);
                this.el.timerOverlay.classList.remove('active');
            },

            updateNav(index) {
                this.el.navItems.forEach(item => item.classList.remove('active'));
                if (this.el.navItems[index]) {
                    this.el.navItems[index].classList.add('active');
                }
            }
        };

        const TestSuite = {
            async run() {
                console.clear();
                console.log('%c Starting Hypertrophy App Tests...', 'color: #4ecdc4; font-size: 14px; font-weight: bold;');
                let passed = 0;
                let cases = [
                    this.testInitialState,
                    this.testNavigation,
                    this.testCardToggle,
                    this.testDayCycle
                ];

                for (const test of cases) {
                    try {
                        await test.call(this);
                        passed++;
                    } catch (e) {
                        console.error(` Test Failed: ${test.name}`, e);
                    }
                }

                if (passed === cases.length) {
                    console.log(`%c All ${passed} tests passed!`, 'color: #4cd964; font-size: 16px; font-weight: bold;');
                    alert('All tests passed! Check console for details.');
                }
            },

            assert(condition, message) {
                if (!condition) {
                    throw new Error(message);
                }
                console.log(`%c   ${message}`, 'color: #888');
            },

            async wait(ms) {
                return new Promise(r => setTimeout(r, ms));
            },

            async testInitialState() {
                console.group('Test: Initial State');
                // Check if Day 1 is active by default
                const day1 = document.querySelector('.nav-item[data-day="0"]');
                this.assert(day1.classList.contains('active'), 'Day 1 should be active initially');

                // Check if Day 4 is NOT active
                const day4 = document.querySelector('.nav-item[data-day="3"]');
                this.assert(!day4.classList.contains('active'), 'Day 4 should NOT be active');

                // Check Title
                const title = document.getElementById('day-title').textContent;
                this.assert(title === 'Push A', 'Title should be "Push A"');
                console.groupEnd();
            },

            async testNavigation() {
                console.group('Test: Navigation');

                // Click Day 2
                App.goToDay(1);
                await this.wait(600); // Wait for transition
                const day2 = document.querySelector('.nav-item[data-day="1"]');
                const title = document.getElementById('day-title').textContent;

                this.assert(day2.classList.contains('active'), 'Day 2 should be active after click');
                this.assert(title === 'Pull A', 'Title should change to "Pull A"');

                // Check invalid dual highlight
                const day1 = document.querySelector('.nav-item[data-day="0"]');
                this.assert(!day1.classList.contains('active'), 'Day 1 should NOT be active anymore');

                // Return to Day 1
                App.goToDay(0);
                await this.wait(600);
                console.groupEnd();
            },

            async testCardToggle() {
                console.group('Test: Card Interactions');
                // Target first card
                const card = document.getElementById('push-a-0');

                // Reset if already expanded
                if (card.classList.contains('expanded')) card.classList.remove('expanded');

                // Simulate click
                card.click();
                await this.wait(100);
                this.assert(card.classList.contains('expanded'), 'Card should expand on click');

                // Simulate click again
                card.click();
                await this.wait(100);
                this.assert(!card.classList.contains('expanded'), 'Card should collapse on second click');
                console.groupEnd();
            },

            async testDayCycle() {
                console.group('Test: Full Cycle');
                for (let i = 0; i < 4; i++) {
                    App.goToDay(i);
                    await this.wait(400);
                    const nav = document.querySelector(`.nav-item[data-day="${i}"]`);
                    this.assert(nav.classList.contains('active'), `Day ${i + 1} activated`);
                }
                // Reset
                App.goToDay(0);
                console.groupEnd();
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            try {
                window.App.init();
                // Initialize AI Coach
                if (window.MrCoach) window.MrCoach.init();
            } catch (e) {
                console.error("App Init Failed:", e);
                alert("App failed to start. Check console.");
            }
        });
    </script>


</body>

</html>